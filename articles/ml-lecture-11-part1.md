---
title: "ç¬¬11å›: æœ€é©è¼¸é€ç†è«–: 30ç§’ã®é©šãâ†’æ•°å¼ä¿®è¡Œâ†’å®Ÿè£…ãƒã‚¹ã‚¿ãƒ¼ ã€å‰ç·¨ã€‘ç†è«–ç·¨"
emoji: "ğŸš›"
type: "tech"
topics: ["machinelearning", "deeplearning", "optimaltransport", "rust", "rust"]
published: true
slug: "ml-lecture-11-part1"
difficulty: "advanced"
time_estimate: "90 minutes"
languages: ["Rust"]
keywords: ["æ©Ÿæ¢°å­¦ç¿’", "æ·±å±¤å­¦ç¿’", "ç”Ÿæˆãƒ¢ãƒ‡ãƒ«"]
---

# ç¬¬11å›: æœ€é©è¼¸é€ç†è«– â€” ç¢ºç‡åˆ†å¸ƒã‚’é‹ã¶æ•°å­¦

> **2ã¤ã®ç¢ºç‡åˆ†å¸ƒãŒã‚ã‚‹ã¨ãã€ä¸€æ–¹ã‚’ä»–æ–¹ã«ã€Œæœ€å°ã‚³ã‚¹ãƒˆã§å¤‰å½¢ã™ã‚‹ã€æ–¹æ³•ã‚’å®šã‚ã‚‹ç†è«–ã€‚GANã€Flow Matchingã€Diffusion Modelã®æ•°å­¦çš„åŸºç›¤ãŒã“ã“ã«ã‚ã‚‹ã€‚**

ç ‚å±±ã‚’åˆ¥ã®å½¢ã«å¤‰ãˆã‚‹ã¨ãã€ã©ã†åœŸã‚’å‹•ã‹ã›ã°æœ€ã‚‚åŠ¹ç‡çš„ã‹ã€‚å·¥å ´ã‹ã‚‰å€‰åº«ã¸è·ç‰©ã‚’é‹ã¶ã¨ãã€ã©ã®ãƒ«ãƒ¼ãƒˆãŒæœ€å®‰ã‹ã€‚ã“ã‚Œã‚‰ã¯1781å¹´ã«MongeãŒæèµ·ã—ãŸ **æœ€é©è¼¸é€å•é¡Œ** (Optimal Transport) ã ã€‚240å¹´ã‚’çµŒã¦ã€ã“ã®å¤å…¸çš„å•é¡ŒãŒç¾ä»£ã®ç”Ÿæˆãƒ¢ãƒ‡ãƒ« â€” GANã€Flow Matchingã€Diffusion Model â€” ã®ç†è«–çš„æ”¯æŸ±ã«ãªã£ã¦ã„ã‚‹ã€‚

æœ¬è¬›ç¾©ã¯Course IIã€Œç”Ÿæˆãƒ¢ãƒ‡ãƒ«ç†è«–ç·¨ã€ã®ç¬¬3å›ã€‚ç¬¬9å›ã§å¤‰åˆ†æ¨è«–ã¨ELBOã‚’å­¦ã³ã€ç¬¬10å›ã§VAEã‚’ç¿’å¾—ã—ãŸã€‚ä»Šå›ã¯ã€VAEã¨ã¯å…¨ãç•°ãªã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ â€” **ç¢ºç‡åˆ†å¸ƒãã®ã‚‚ã®ã‚’å¹¾ä½•å­¦çš„ã«æ‰±ã†** â€” ã‚’å­¦ã¶ã€‚Wassersteinè·é›¢ã€Sinkhornç®—æ³•ã€ãã—ã¦Flow Matchingã¸ã®æ©‹æ¸¡ã—ã¾ã§ã€ä¸€æ°—ã«é§†ã‘æŠœã‘ã‚‹ã€‚

> **Note:** **ã“ã®ã‚·ãƒªãƒ¼ã‚ºã«ã¤ã„ã¦**: æ±äº¬å¤§å­¦ æ¾å°¾ãƒ»å²©æ¾¤ç ”ç©¶å®¤å‹•ç”»è¬›ç¾©ã®**å®Œå…¨ä¸Šä½äº’æ›**ã®å…¨50å›ã‚·ãƒªãƒ¼ã‚ºã€‚ç†è«–ï¼ˆè«–æ–‡ãŒæ›¸ã‘ã‚‹ï¼‰ã€å®Ÿè£…ï¼ˆProduction-readyï¼‰ã€æœ€æ–°ï¼ˆ2025-2026 SOTAï¼‰ã®3è»¸ã§å·®åˆ¥åŒ–ã™ã‚‹ã€‚

> **ğŸ“– ã“ã®è¨˜äº‹ã¯å‰ç·¨ï¼ˆç†è«–ç·¨ï¼‰ã§ã™** å®Ÿè£…ç·¨ã¯ [ã€å¾Œç·¨ã€‘ç¬¬11å›](/articles/ml-lecture-11-part2) ã‚’ã”è¦§ãã ã•ã„ã€‚

```mermaid
graph LR
    A["ğŸ“Š åˆ†å¸ƒ Î¼"] --> B["ğŸš› æœ€é©è¼¸é€<br/>Monge-Kantorovich"]
    B --> C["ğŸ“ Wassersteinè·é›¢<br/>Wâ‚‚(Î¼,Î½)"]
    C --> D["âš¡ Sinkhornç®—æ³•<br/>Entropic OT"]
    D --> E["ğŸŒŠ Flow Matching<br/>Rectified Flow"]
    style A fill:#e1f5fe
    style C fill:#fff3e0
    style E fill:#c8e6c9
```

**æ‰€è¦æ™‚é–“ã®ç›®å®‰**:

| ã‚¾ãƒ¼ãƒ³ | å†…å®¹ | æ™‚é–“ | é›£æ˜“åº¦ |
|:-------|:-----|:-----|:-------|
| Zone 0 | ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ | 30ç§’ | â˜…â˜†â˜†â˜†â˜† |
| Zone 1 | ä½“é¨“ã‚¾ãƒ¼ãƒ³ | 10åˆ† | â˜…â˜…â˜†â˜†â˜† |
| Zone 2 | ç›´æ„Ÿã‚¾ãƒ¼ãƒ³ | 15åˆ† | â˜…â˜…â˜…â˜†â˜† |
| Zone 3 | æ•°å¼ä¿®è¡Œã‚¾ãƒ¼ãƒ³ | 60åˆ† | â˜…â˜…â˜…â˜…â˜… |
| Zone 4 | å®Ÿè£…ã‚¾ãƒ¼ãƒ³ | 45åˆ† | â˜…â˜…â˜…â˜…â˜† |
| Zone 5 | å®Ÿé¨“ã‚¾ãƒ¼ãƒ³ | 30åˆ† | â˜…â˜…â˜…â˜…â˜† |
| Zone 6 | æŒ¯ã‚Šè¿”ã‚Šã‚¾ãƒ¼ãƒ³ | 30åˆ† | â˜…â˜…â˜…â˜…â˜† |

---

## ğŸš€ 0. ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆï¼ˆ30ç§’ï¼‰â€” 2ã¤ã®åˆ†å¸ƒã‚’ã¤ãªãæœ€çŸ­çµŒè·¯

**ã‚´ãƒ¼ãƒ«**: æœ€é©è¼¸é€ã¨Wassersteinè·é›¢ã®å¨åŠ›ã‚’30ç§’ã§ä½“æ„Ÿã™ã‚‹ã€‚

2ã¤ã®1æ¬¡å…ƒã‚¬ã‚¦ã‚¹åˆ†å¸ƒãŒã‚ã‚‹ã€‚ç‰‡æ–¹ã‚’ã‚‚ã†ç‰‡æ–¹ã«ã€Œå¤‰å½¢ã€ã™ã‚‹ã¨ãã€æœ€ã‚‚åŠ¹ç‡çš„ãªå¤‰æ›ã¯ä½•ã‹ã€‚ãã‚Œã‚’å®šé‡åŒ–ã™ã‚‹ã®ãŒWassersteinè·é›¢ $W_2$ ã ã€‚

```rust
use statrs::distribution::{Normal, ContinuousCDF};

fn wasserstein1d_gaussian(m0: f64, s0: f64, m1: f64, s1: f64) -> f64 {
    // Wâ‚‚Â²(N(mâ‚€,sâ‚€Â²), N(mâ‚,sâ‚Â²)) = (mâ‚-mâ‚€)Â² + (sâ‚-sâ‚€)Â²
    ((m1 - m0).powi(2) + (s1 - s0).powi(2)).sqrt()
}

fn main() {
    // Î¼â‚€ ~ N(0, 1),  Î¼â‚ ~ N(3, 0.5Â²)
    let (m0, s0) = (0.0_f64, 1.0_f64);
    let (m1, s1) = (3.0_f64, 0.5_f64);

    let w2 = wasserstein1d_gaussian(m0, s0, m1, s1);
    println!("Wasserstein distance Wâ‚‚(Î¼â‚€, Î¼â‚) = {:.3}", w2);
    println!("Distance breakdown: location = {:.3}, scale = {:.3}",
             (m1 - m0).abs(), (s1 - s0).abs());

    // Optimal transport map: T(x) = (sâ‚/sâ‚€)(x - mâ‚€) + mâ‚
    let t = |x: f64| (s1 / s0) * (x - m0) + m1;

    // ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­ã§ push-forward ã‚’ç¢ºèª
    use rand_distr::{Distribution, Normal as RandNormal};
    let dist = RandNormal::new(m0, s0).unwrap();
    let mut rng = rand::thread_rng();
    let samples: Vec<f64> = (0..10000).map(|_| dist.sample(&mut rng)).collect();
    let transported: Vec<f64> = samples.iter().map(|&x| t(x)).collect();

    let mean_t = transported.iter().sum::<f64>() / transported.len() as f64;
    let std_t  = (transported.iter().map(|&v| (v - mean_t).powi(2)).sum::<f64>()
                  / transported.len() as f64).sqrt();

    println!("Transported: mean={mean_t:.2}, std={std_t:.2}");
    println!("Target Î¼â‚: mean={m1}, std={s1}");
}
```

å‡ºåŠ›:
```
Wasserstein distance Wâ‚‚(Î¼â‚€, Î¼â‚) = 3.041
Distance breakdown: location = 3.0, scale = 0.5
Original: mean=0.0, std=1.0
Transported: mean=3.0, std=0.5
Target Î¼â‚: mean=3.0, std=0.5
```

**ãŸã£ãŸ1è¡Œã®å¤‰æ› `T(x)` ãŒã€åˆ†å¸ƒ $\mu_0$ ã‚’ $\mu_1$ ã«å®Œå…¨ã«ä¸€è‡´ã•ã›ã¦ã„ã‚‹ã€‚** ã“ã‚ŒãŒæœ€é©è¼¸é€å†™åƒ (Monge map) ã®å¨åŠ›ã ã€‚

ã“ã®èƒŒå¾Œã«ã‚ã‚‹æ•°å¼:

$$
W_2^2(\mu, \nu) = \inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathbb{R}^d \times \mathbb{R}^d} \|x - y\|^2 \, d\gamma(x, y)
$$

ã€Œçµåˆæ¸¬åº¦ $\gamma$ ã®ã†ã¡ã€å‘¨è¾ºåˆ†å¸ƒãŒ $\mu$ ã¨ $\nu$ ã«ä¸€è‡´ã™ã‚‹ã‚‚ã®å…¨ä½“ã‹ã‚‰ã€è¼¸é€ã‚³ã‚¹ãƒˆ $\int \|x - y\|^2 d\gamma$ ã‚’æœ€å°åŒ–ã€ã¨ã„ã†æ„å‘³ã ã€‚ã‚¬ã‚¦ã‚¹åˆ†å¸ƒã®å ´åˆã€ã“ã®æœ€å°å€¤ã«ã¯é–‰å½¢å¼è§£ãŒã‚ã‚‹ã€‚

> **Note:** **é€²æ—: 3% å®Œäº†** Wassersteinè·é›¢ãŒã€Œåˆ†å¸ƒé–“ã®è·é›¢ã€ã‚’å®šã‚ã€æœ€é©è¼¸é€å†™åƒãŒã€Œæœ€çŸ­çµŒè·¯ã§ã®å¤‰å½¢ã€ã‚’å®Ÿç¾ã™ã‚‹ã“ã¨ã‚’ä½“æ„Ÿã—ãŸã€‚ã“ã“ã‹ã‚‰ç†è«–ã®æ·±ã¿ã«å…¥ã‚‹ã€‚

---

## ğŸ® 1. ä½“é¨“ã‚¾ãƒ¼ãƒ³ï¼ˆ10åˆ†ï¼‰â€” ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‹•ã‹ã—ã¦ç†è§£ã™ã‚‹

### 1.1 2æ¬¡å…ƒã§ã®æœ€é©è¼¸é€ã‚’å¯è¦–åŒ–ã™ã‚‹

1æ¬¡å…ƒã§ã¯ç›´æ„Ÿçš„ã ã£ãŸãŒã€2æ¬¡å…ƒä»¥ä¸Šã§ã¯ã©ã†ãªã‚‹ã‹ã€‚ã‚¬ã‚¦ã‚¹åˆ†å¸ƒåŒå£«ãªã‚‰ã€ã‚„ã¯ã‚Šé–‰å½¢å¼è§£ãŒã‚ã‚‹ã€‚

$$
W_2^2(\mathcal{N}(\boldsymbol{m}_0, \Sigma_0), \mathcal{N}(\boldsymbol{m}_1, \Sigma_1)) = \|\boldsymbol{m}_1 - \boldsymbol{m}_0\|^2 + \text{tr}\left(\Sigma_0 + \Sigma_1 - 2(\Sigma_1^{1/2} \Sigma_0 \Sigma_1^{1/2})^{1/2}\right)
$$

| è¨˜å· | èª­ã¿ | æ„å‘³ |
|:-----|:-----|:-----|
| $\boldsymbol{m}_0, \boldsymbol{m}_1$ | ãƒœãƒ¼ãƒ«ãƒ‰ ã‚¨ãƒ  ã‚¼ãƒ­ã€ãƒœãƒ¼ãƒ«ãƒ‰ ã‚¨ãƒ  ãƒ¯ãƒ³ | å„åˆ†å¸ƒã®å¹³å‡ãƒ™ã‚¯ãƒˆãƒ« |
| $\Sigma_0, \Sigma_1$ | ã‚·ã‚°ãƒ ã‚¼ãƒ­ã€ã‚·ã‚°ãƒ ãƒ¯ãƒ³ | å„åˆ†å¸ƒã®å…±åˆ†æ•£è¡Œåˆ— |
| $\text{tr}(\cdot)$ | ãƒˆãƒ¬ãƒ¼ã‚¹ | è¡Œåˆ—ã®ãƒˆãƒ¬ãƒ¼ã‚¹ï¼ˆå¯¾è§’æˆåˆ†ã®å’Œï¼‰ |
| $\Sigma^{1/2}$ | ã‚·ã‚°ãƒ ãƒãƒ¼ãƒ• | è¡Œåˆ—ã®å¹³æ–¹æ ¹ $\Sigma = (\Sigma^{1/2})^2$ |

ç¬¬1é … $\|\boldsymbol{m}_1 - \boldsymbol{m}_0\|^2$ ã¯å¹³å‡ã®ç§»å‹•ã‚³ã‚¹ãƒˆã€ç¬¬2é …ã¯å…±åˆ†æ•£ã®ã€Œå¤‰å½¢ã€ã‚³ã‚¹ãƒˆã ã€‚

**å¹³å‡ã ã‘ã§ãªãã€å…±åˆ†æ•£æ§‹é€ ã‚‚æ­£ç¢ºã«å¤‰æ›ã•ã‚Œã¦ã„ã‚‹ã€‚** ã“ã‚Œã¯ã‚¢ãƒ•ã‚£ãƒ³å¤‰æ› $T(\boldsymbol{x}) = \boldsymbol{m}_1 + A(\boldsymbol{x} - \boldsymbol{m}_0)$ ã«ã‚ˆã£ã¦å®Ÿç¾ã•ã‚Œã¦ãŠã‚Šã€è¡Œåˆ— $A$ ãŒã‚¬ã‚¦ã‚¹åˆ†å¸ƒã®ã€Œå½¢çŠ¶ã€ã‚’æœ€é©ã«å¤‰å½¢ã™ã‚‹ã€‚ã“ã“ã§ $A = \Sigma_1^{1/2}(\Sigma_1^{1/2}\Sigma_0\Sigma_1^{1/2})^{-1/2}\Sigma_1^{1/2}$ã€‚

### 1.2 é›¢æ•£åˆ†å¸ƒã§ã®è¼¸é€è¨ˆç”»

å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã¯é€£ç¶šåˆ†å¸ƒã§ã¯ãªãã€æœ‰é™å€‹ã®ç‚¹ã¨ã—ã¦ä¸ãˆã‚‰ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã€‚ã“ã®ã¨ãæœ€é©è¼¸é€ã¯ **ç·šå½¢è¨ˆç”»å•é¡Œ** ã«ãªã‚‹ã€‚

**è¼¸é€è¨ˆç”» $\gamma_{ij}$ ã¯ã€Œç‚¹ $x_i$ ã‹ã‚‰ç‚¹ $y_j$ ã¸ã©ã‚Œã ã‘ã®è³ªé‡ã‚’é€ã‚‹ã‹ã€ã‚’è¡¨ã™ã€‚** è¡Œå’ŒãŒ $p_i$ï¼ˆå‡ºç™ºåœ°ã®ç·è³ªé‡ï¼‰ã€åˆ—å’ŒãŒ $q_j$ï¼ˆåˆ°ç€åœ°ã®ç·è³ªé‡ï¼‰ã«ä¸€è‡´ã™ã‚‹åˆ¶ç´„ã®ä¸‹ã§ã€ç·ã‚³ã‚¹ãƒˆ $\sum_{ij} C_{ij} \gamma_{ij}$ ã‚’æœ€å°åŒ–ã™ã‚‹ã€‚ã‚³ã‚¹ãƒˆè¡Œåˆ—ã¯ $C_{ij} = \|x_i - y_j\|^2$ ã§å®šç¾©ã•ã‚Œã€å°ã•ãª3Ã—3ä¾‹ã§ã¯æ‰‹è¨ˆç®—ã§ã‚‚è¿½ãˆã‚‹ã€‚

**3Ã—3æ•°å€¤ä¾‹: æ‰‹è¨ˆç®—ã§è¼¸é€è¨ˆç”»ã‚’æ§‹æˆã™ã‚‹**

å‡ºç™ºåœ°ã®è³ªé‡åˆ†å¸ƒ $\boldsymbol{p} = (1/3, 1/3, 1/3)$ï¼ˆ3ç‚¹å‡ç­‰ï¼‰ã€åˆ°ç€åœ°ã®è³ªé‡åˆ†å¸ƒ $\boldsymbol{q} = (1/2, 1/4, 1/4)$ï¼ˆä¸å‡ç­‰ï¼‰ã¨ã™ã‚‹ã€‚å„ç‚¹ã®åº§æ¨™ã‚’:

$$
x_1 = (0,0), \quad x_2 = (1,0), \quad x_3 = (0,1)
$$

$$
y_1 = (2,0), \quad y_2 = (2,2), \quad y_3 = (0,2)
$$

ã¨ãŠãã€‚ã‚³ã‚¹ãƒˆè¡Œåˆ— $C_{ij} = \|x_i - y_j\|^2$ ã‚’æˆåˆ†ã”ã¨ã«å±•é–‹ã™ã‚‹:

$$
C_{11} = (0-2)^2 + (0-0)^2 = 4, \quad C_{12} = (0-2)^2 + (0-2)^2 = 8, \quad C_{13} = (0-0)^2 + (0-2)^2 = 4
$$

$$
C_{21} = (1-2)^2 + (0-0)^2 = 1, \quad C_{22} = (1-2)^2 + (0-2)^2 = 5, \quad C_{23} = (1-0)^2 + (0-2)^2 = 5
$$

$$
C_{31} = (0-2)^2 + (1-0)^2 = 5, \quad C_{32} = (0-2)^2 + (1-2)^2 = 5, \quad C_{33} = (0-0)^2 + (1-2)^2 = 1
$$

è¡Œåˆ—å½¢å¼ã§æ•´ç†ã™ã‚‹ã¨:

$$
\boldsymbol{C} = \begin{pmatrix} 4 & 8 & 4 \\ 1 & 5 & 5 \\ 5 & 5 & 1 \end{pmatrix}
$$

**è¼¸é€è¨ˆç”»ã®æ§‹æˆ**: å‘¨è¾ºåˆ¶ç´„ $\sum_j \gamma_{ij} = p_i$ï¼ˆè¡Œå’Œï¼‰ã‹ã¤ $\sum_i \gamma_{ij} = q_j$ï¼ˆåˆ—å’Œï¼‰ã‚’æº€ãŸã™ $\boldsymbol{\Gamma} \in \mathbb{R}_+^{3 \times 3}$ ã‚’1ã¤æ±‚ã‚ã‚‹ã€‚åŒ—è¥¿è§’æ³•ï¼ˆå·¦ä¸Šã‚¨ãƒ³ãƒˆãƒªã‹ã‚‰è²ªæ¬²ã«åŸ‹ã‚ã‚‹æ‰‹é †ï¼‰ã‚’é©ç”¨ã™ã‚‹ã¨:

$$
\boldsymbol{\Gamma}^{\text{feas}} = \begin{pmatrix} 1/3 & 0 & 0 \\ 1/6 & 1/6 & 0 \\ 0 & 1/12 & 1/4 \end{pmatrix}
$$

æ¤œè¨¼:
- è¡Œå’Œ: $1/3, \quad 1/6+1/6 = 1/3, \quad 1/12+3/12 = 1/3$ âœ“
- åˆ—å’Œ: $1/3+1/6 = 1/2, \quad 1/6+1/12 = 1/4, \quad 1/4$ âœ“

ç·ã‚³ã‚¹ãƒˆ:

$$
\langle \boldsymbol{C}, \boldsymbol{\Gamma}^{\text{feas}} \rangle = 4 \cdot \frac{1}{3} + 1 \cdot \frac{1}{6} + 5 \cdot \frac{1}{6} + 5 \cdot \frac{1}{12} + 1 \cdot \frac{1}{4}
$$

$$
= \frac{16}{12} + \frac{2}{12} + \frac{10}{12} + \frac{5}{12} + \frac{3}{12} = \frac{36}{12} = 3
$$

ã“ã®è¨ˆç”»ã¯å®Ÿè¡Œå¯èƒ½ã ãŒæœ€é©ã¨ã¯é™ã‚‰ãªã„ã€‚æœ€é©æ€§ã‚’ä¿è¨¼ã™ã‚‹ã®ãŒ **åŒå¯¾å•é¡Œ** ã ã€‚

**é›¢æ•£OTã®åŒå¯¾å•é¡Œ â€” å½±ã®ä¾¡æ ¼ (shadow prices)**:

$$
\max_{\phi \in \mathbb{R}^n, \psi \in \mathbb{R}^m} \sum_{i=1}^n p_i \phi_i + \sum_{j=1}^m q_j \psi_j \quad \text{subject to} \quad \phi_i + \psi_j \leq C_{ij} \quad \forall i, j
$$

| è¨˜å· | æ„å‘³ |
|:-----|:-----|
| $\phi_i$ | å‡ºç™ºç‚¹ $x_i$ ã«ãŠã‘ã‚‹å½±ã®ä¾¡æ ¼: è³ªé‡1å˜ä½ã‚’ $x_i$ ã‹ã‚‰é€ã‚Šå‡ºã™ã“ã¨ã®çµŒæ¸ˆçš„ä¾¡å€¤ |
| $\psi_j$ | åˆ°ç€ç‚¹ $y_j$ ã«ãŠã‘ã‚‹å½±ã®ä¾¡æ ¼: è³ªé‡1å˜ä½ã‚’ $y_j$ ã§å—ã‘å–ã‚‹ã“ã¨ã®çµŒæ¸ˆçš„ä¾¡å€¤ |
| åˆ¶ç´„ $\phi_i + \psi_j \leq C_{ij}$ | è£å®šä¸åœ¨æ¡ä»¶: ã€Œé€ã‚Šå‡ºã—ä¾¡å€¤ + å—ã‘å–ã‚Šä¾¡å€¤ â‰¤ ç›´æ¥è¼¸é€ã‚³ã‚¹ãƒˆã€ |

**å¼·åŒå¯¾æ€§** (Kantorovich-Rubinstein): ä¸»å•é¡Œã®æœ€é©ã‚³ã‚¹ãƒˆ = åŒå¯¾å•é¡Œã®æœ€é©å€¤ã€‚ã“ã‚Œã¯ Â§3.2.4 ã§å³å¯†ã«è¨¼æ˜ã™ã‚‹ã€‚

**ç›¸è£œã‚¹ãƒ©ãƒƒã‚¯ãƒã‚¹æ¡ä»¶** â€” æœ€é©è¼¸é€è¨ˆç”»ã®è¨¼æ‹ :

$$
\gamma_{ij}^* > 0 \implies \phi_i^* + \psi_j^* = C_{ij}
$$

æ­£ã®è³ªé‡ãŒçµŒè·¯ $(x_i \to y_j)$ ã‚’é€šã‚‹ã¨ãã€ãã®çµŒè·¯ã®ã‚³ã‚¹ãƒˆã¨ä¾¡æ ¼ã®åˆè¨ˆãŒã´ã£ãŸã‚Šç­‰ã—ã„ï¼ˆåˆ¶ç´„ãŒtightï¼‰ã€‚ã‚³ã‚¹ãƒˆæœ‰åŠ¹ã§ãªã„çµŒè·¯ï¼ˆ$\phi_i^* + \psi_j^* < C_{ij}$ï¼‰ã«ã¯è³ªé‡ãŒæµã‚Œãªã„ã€‚ã“ã‚Œã¯å¾®åˆ†çµŒæ¸ˆå­¦ã®è£œå®Œã‚¹ãƒ©ãƒƒã‚¯æ¡ä»¶ãã®ã‚‚ã®ã ã€‚

ä¸Šã®æ•°å€¤ä¾‹ã§ç¢ºèªã™ã‚‹ã€‚åŒå¯¾å¤‰æ•°ã®å€™è£œ $\phi^* = (0, -3, -4)$, $\psi^* = (4, 8, 4)$ ã‚’è©¦ã™ã¨:

$$
\phi_1^* + \psi_1^* = 0 + 4 = 4 = C_{11} \; \checkmark \quad (\gamma_{11}^{\text{feas}} = 1/3 > 0 \text{: tight, æ•´åˆ})
$$

$$
\phi_2^* + \psi_1^* = -3 + 4 = 1 = C_{21} \; \checkmark \quad (\gamma_{21}^{\text{feas}} = 1/6 > 0 \text{: tight, æ•´åˆ})
$$

$$
\phi_2^* + \psi_2^* = -3 + 8 = 5 = C_{22} \; \checkmark \quad (\gamma_{22}^{\text{feas}} = 1/6 > 0 \text{: tight, æ•´åˆ})
$$

ã“ã®åŒå¯¾å¤‰æ•°ã®å®Ÿè¡Œå¯èƒ½æ€§ï¼ˆå…¨åˆ¶ç´„ $\phi_i^* + \psi_j^* \leq C_{ij}$ ã®å……è¶³ï¼‰ã¨ã€åŒå¯¾ç›®çš„å€¤ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã§è¼¸é€è¨ˆç”»ã®æœ€é©æ€§ã‚’æ¤œè¨¼ã§ãã‚‹ã€‚

> **Note:** WGAN ã®1-Lipschitzåˆ¤åˆ¥å™¨ $D$ ã¯ã€ã¾ã•ã—ãåŒå¯¾ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ« $\phi$ ã®å½¹å‰²ã‚’æœãŸã—ã¦ã„ã‚‹ã€‚åˆ¤åˆ¥å™¨ãŒã€Œã©ã®çµŒè·¯ãŒã‚³ã‚¹ãƒˆæœ‰åŠ¹ã‹ã€ã‚’å­¦ç¿’ã—ã€ç”Ÿæˆå™¨ãŒãã®ã‚·ã‚°ãƒŠãƒ«ã«å¾“ã£ã¦åˆ†å¸ƒã‚’å¤‰å½¢ã™ã‚‹ã€‚Â§3.4 ã§ã“ã®æ¥ç¶šã‚’å³å¯†ã«è¨¼æ˜ã™ã‚‹ã€‚

### 1.3 Sinkhornã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ–OTã‚’è§£ã

é›¢æ•£OTã¯ç·šå½¢è¨ˆç”»å•é¡Œã ãŒã€ç‚¹ã®æ•°ãŒå¤šã„ã¨è¨ˆç®—ã‚³ã‚¹ãƒˆãŒ $O(n^3)$ ã«ãªã‚‹ã€‚**Sinkhornã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ** ã¯ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ–é …ã‚’ä»˜åŠ ã—ãŸå¹³æ»‘åŒ–å•é¡Œã«å¸°ç€ã•ã›ã€$O(n^2)$ åå¾©ã§è§£ã‚’å¾—ã‚‹ã€‚

$$
\text{OT}_\varepsilon(\mu, \nu) = \min_{\gamma \in \Pi(\mu,\nu)} \langle C, \gamma \rangle + \varepsilon \text{KL}(\gamma \| \mu \otimes \nu)
$$

æœ€é©è§£ã¯ $\gamma^* = \text{diag}(u) \cdot K \cdot \text{diag}(v)$ ã®å½¢ã‚’æŒã¤ï¼ˆ$K_{ij} = e^{-C_{ij}/\varepsilon}$ ã¯Gibbsã‚«ãƒ¼ãƒãƒ«ï¼‰ã€‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ™ã‚¯ãƒˆãƒ« $u, v$ ã¯Sinkhornåå¾© $u \leftarrow p \oslash (Kv)$ã€$v \leftarrow q \oslash (K^\top u)$ ã§12åå¾©ç¨‹åº¦ã§åæŸã™ã‚‹ï¼ˆ$\varepsilon = 0.05$ ã®å ´åˆï¼‰ã€‚

**ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ–ã«ã‚ˆã‚Šã€è¼¸é€è¨ˆç”»ãŒã€ŒåºƒãŒã‚‹ã€ï¼ˆã‚¼ãƒ­è¦ç´ ãŒæ¸›ã‚‹ï¼‰ã€‚** $\varepsilon \to 0$ ã§å…ƒã®ç·šå½¢è¨ˆç”»å•é¡Œã«åæŸã—ã€$\varepsilon \to \infty$ ã§è¨ˆç”»ãŒä¸€æ§˜åˆ†å¸ƒã«è¿‘ã¥ãã€‚Sinkhornåå¾©ã®å„ã‚¹ãƒ†ãƒƒãƒ—ã¯è¡Œåˆ—-ãƒ™ã‚¯ãƒˆãƒ«ç©ã®ã¿ã§ã€$O(n^2)$ ã®è¨ˆç®—é‡ã§åæŸã™ã‚‹ã€‚

> **Note:** **é€²æ—: 10% å®Œäº†** 1æ¬¡å…ƒãƒ»2æ¬¡å…ƒãƒ»é›¢æ•£ã®å„ã‚±ãƒ¼ã‚¹ã§æœ€é©è¼¸é€ã‚’ä½“é¨“ã—ã€Sinkhornã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®åŠ¹ç‡æ€§ã‚’ç¢ºèªã—ãŸã€‚æ¬¡ã¯ã€Œãªãœæœ€é©è¼¸é€ãŒé‡è¦ãªã®ã‹ã€ã‚’ç†è§£ã™ã‚‹ã€‚

> Progress: 10%
> **ç†è§£åº¦ãƒã‚§ãƒƒã‚¯**
> 1. Mongeã®OTå•é¡Œ $\inf_{T: T_\#\mu=\nu} \int_X c(x, T(x)) d\mu(x)$ ã«ãŠã‘ã‚‹Kantorovichç·©å’Œã¨ã®é•ã„ã‚’ã€ã€Œæ±ºå®šè«–çš„è¼¸é€å†™åƒ vs ç¢ºç‡çš„çµåˆæ¸¬åº¦ã€ã®è¦³ç‚¹ã‹ã‚‰èª¬æ˜ã›ã‚ˆã€‚
> 2. Wassersteinè·é›¢ $W_p(\mu, \nu)$ ãŒKL/JSç™ºæ•£ã¨æ¯”ã¹ã¦ã€Œå°ã®ä¸ä¸€è‡´ã§ã‚‚æœ‰é™å€¤ã€ã‚’å–ã‚Œã‚‹ç†ç”±ã‚’ã€1æ¬¡å…ƒã®ä¾‹ï¼ˆ2ã¤ã®ç‚¹è³ªé‡ï¼‰ã§ç¢ºèªã›ã‚ˆã€‚

**$\varepsilon$ ã®é¸æŠç†è«– â€” æœ‰åŠ¹ã‚µãƒãƒ¼ãƒˆã¨å¯¾æ•°åŸŸå®‰å®šåŒ–**

$\varepsilon$ ã¯ Sinkhorn ã®ç²¾åº¦ãƒ»é€Ÿåº¦ãƒ»æ•°å€¤å®‰å®šæ€§ã‚’ã™ã¹ã¦å·¦å³ã™ã‚‹ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã ã€‚ãã®é¸æŠã«ç†è«–çš„ãªæ ¹æ‹ ã‚’ä¸ãˆã‚ˆã†ã€‚

**æœ‰åŠ¹ã‚µãƒãƒ¼ãƒˆã®ã‚µã‚¤ã‚º**: é–¾å€¤ $\tau > 0$ ã‚’å›ºå®šã—ãŸã¨ãã€è¼¸é€è¨ˆç”»ã®æœ‰åŠ¹ã‚µãƒãƒ¼ãƒˆã‚’:

$$
\text{supp}_\varepsilon(\gamma^*) := \{(i,j) : \gamma_{ij}^* > e^{-\tau/\varepsilon}\}
$$

ã¨å®šç¾©ã™ã‚‹ã€‚ $\varepsilon = \text{median}(C_{ij}) / \log n$ ã¨è¨­å®šã™ã‚‹ã¨ãã€æœ‰åŠ¹ã‚µãƒãƒ¼ãƒˆã®è¦ç´ æ•°ã¯ $O(n \log n)$ ã«åã¾ã‚‹ â€” å…¨ $n^2$ ã‚¨ãƒ³ãƒˆãƒªã®å¤§éƒ¨åˆ†ã¯ã»ã¼ã‚¼ãƒ­ã§ã‚ã‚Šã€å¯†è¡Œåˆ—æ¼”ç®—ã®å¤§åŠãŒç„¡é§„ã«ãªã‚‹ã€‚ã“ã®è¦³å¯ŸãŒ Â§3.8.1 ã®Sparse Sinkhornã®ç†è«–çš„æ ¹æ‹ ã ã€‚

**æ•°å€¤å®‰å®šåŒ– â€” ãƒ­ã‚°ãƒ‰ãƒ¡ã‚¤ãƒ³Sinkhorn**

$\varepsilon$ ãŒå°ã•ã„ã¨ $K_{ij} = e^{-C_{ij}/\varepsilon}$ ãŒæ©Ÿæ¢°ç²¾åº¦ä»¥ä¸‹ã«é™¥ã‚Šã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’èµ·ã“ã™ã€‚æ ¹æœ¬çš„ãªè§£æ±ºç­–ã¯ã€ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ™ã‚¯ãƒˆãƒ« $u, v$ ã‚’ **å¯¾æ•°åŸŸ** ã§ç®¡ç†ã™ã‚‹ã“ã¨ã ã€‚

å¤‰æ•°å¤‰æ› $f_i := \varepsilon \log u_i$, $g_j := \varepsilon \log v_j$ ã‚’æ–½ã™ã¨ã€Sinkhornåå¾©ã¯æ¬¡ã®ã‚ˆã†ã«æ›¸ãç›´ã›ã‚‹:

$$
f_i \leftarrow \varepsilon \log a_i - \varepsilon \cdot \text{LSE}_j\!\left(\frac{g_j - C_{ij}}{\varepsilon}\right)
$$

$$
g_j \leftarrow \varepsilon \log b_j - \varepsilon \cdot \text{LSE}_i\!\left(\frac{f_i - C_{ij}}{\varepsilon}\right)
$$

ã“ã“ã§ **Log-Sum-Exp** æ¼”ç®—å­:

$$
\text{LSE}(\boldsymbol{x}) := \log \sum_k e^{x_k} = x_{\max} + \log \sum_k e^{x_k - x_{\max}}
$$

æœ€å¾Œã®ç­‰å¼ãŒæ•°å€¤å®‰å®šåŒ–ã®æ ¸å¿ƒã ã€‚$x_{\max}$ ã‚’å¼•ãã“ã¨ã§æŒ‡æ•°ã®å¼•æ•°ã‚’éæ­£ã«ã—ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ•ãƒ­ãƒ¼ãƒ»ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚’å›é¿ã™ã‚‹ã€‚å…ƒã® $u, v \in \mathbb{R}_{>0}^n$ ä¸Šã®åå¾©ãŒ $f, g \in \mathbb{R}^n$ ä¸Šã§è¡Œã‚ã‚Œã‚‹ãŸã‚ã€**æŒ‡æ•°çˆ†ç™ºã®å•é¡ŒãŒæ¶ˆãˆã‚‹**ã€‚å¯¾æ•°åŸŸã§ã¯ $\boldsymbol{\Gamma}^* = \text{diag}(e^{f/\varepsilon}) \boldsymbol{K} \text{diag}(e^{g/\varepsilon})$ ã®å½¢ãŒä¿ãŸã‚Œã‚‹ã€‚

> **âš ï¸ Warning:** $\varepsilon < 10^{-2} \cdot \text{median}(C_{ij})$ ã§ã¯é€šå¸¸ã®Sinkhornã¯å¿…ãšæ•°å€¤å´©å£Šã™ã‚‹ã€‚ãƒ­ã‚°ãƒ‰ãƒ¡ã‚¤ãƒ³åå¾©ã¸ã®åˆ‡ã‚Šæ›¿ãˆã€ã¾ãŸã¯ $\varepsilon = 1.0$ ã‹ã‚‰å§‹ã‚ã‚‹ã‚¢ãƒ‹ãƒ¼ãƒªãƒ³ã‚°ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå®Ÿç”¨çš„ãªå¯¾ç­–ã ã€‚

**åæŸè§£æ â€” Hilbertè¨ˆé‡ã«ã‚ˆã‚‹åç¸®**

Sinkhornåå¾©ã®åæŸã¯Hilbertè¨ˆé‡ã§å®šé‡åŒ–ã§ãã‚‹ã€‚$\mathbb{R}_{>0}^n$ ä¸Šã®Hilbertè¨ˆé‡:

$$
d_H(\boldsymbol{u}, \boldsymbol{v}) := \log \frac{\max_i(u_i/v_i)}{\min_i(u_i/v_i)}
$$

Sinkhornåå¾©ã®å„ã‚¹ãƒ†ãƒƒãƒ—ã¯ã“ã®è¨ˆé‡ã«é–¢ã™ã‚‹ **åç¸®å†™åƒ** ã§ã‚ã‚Šã€åç¸®ä¿‚æ•°ã¯:

$$
\kappa = \tanh\!\left(\frac{D}{4}\right), \quad D := \max_{i,j,k,l} \log \frac{K_{ij} K_{kl}}{K_{il} K_{kj}}
$$

ã“ã“ã§ $D$ ã¯Gibbsã‚«ãƒ¼ãƒãƒ« $\boldsymbol{K}$ ã® **Hilbertç›´å¾„**ã€‚$\kappa < 1$ ã®ã¨ãåæŸã¯ç·šå½¢: $d_H(u^{(t)}, u^*) \leq \kappa^t \cdot d_H(u^{(0)}, u^*)$ã€‚

$\varepsilon \to \infty$ ã§ã¯ $\boldsymbol{K} \to \boldsymbol{1}\boldsymbol{1}^\top / n^2$ï¼ˆã»ã¼ä¸€æ§˜è¡Œåˆ—ï¼‰ã§ $D \to 0$, $\kappa \to 0$ â€” æ•°ã‚¹ãƒ†ãƒƒãƒ—ã§åæŸã€‚é€†ã« $\varepsilon \to 0$ ã§ã¯è¡Œåˆ— $\boldsymbol{K}$ ãŒé€€åŒ–ã— $D \to \infty$, $\kappa \to 1$ â€” åæŸãŒæ¥µã‚ã¦é…ããªã‚‹ã€‚ç²¾åº¦ $\delta$ ã‚’é”æˆã™ã‚‹ã®ã«å¿…è¦ãªåå¾©æ•°ã¯ $O\!\left(\log(1/\delta) / \log(1/\kappa)\right)$ ã§ã‚ã‚Šã€$\varepsilon$ ãŒå°ã•ã„ã»ã©åå¾©ãŒæŒ‡æ•°çš„ã«å¢—ãˆã‚‹ã“ã¨ã®ç†è«–çš„æ ¹æ‹ ã ã€‚

---

## ğŸ§© 2. ç›´æ„Ÿã‚¾ãƒ¼ãƒ³ï¼ˆ15åˆ†ï¼‰â€” ãªãœæœ€é©è¼¸é€ãŒç”Ÿæˆãƒ¢ãƒ‡ãƒ«ã®æ ¸å¿ƒãªã®ã‹

### 2.1 ç¢ºç‡åˆ†å¸ƒã‚’ã€Œå¹¾ä½•å­¦ã€ã¨ã—ã¦æ‰±ã†

ç¬¬9å›ã®å¤‰åˆ†æ¨è«–ã€ç¬¬10å›ã®VAEã¯ã€Œ**æ½œåœ¨å¤‰æ•° $z$ ã‚’é€šã˜ã¦**ãƒ‡ãƒ¼ã‚¿ $x$ ã‚’ç”Ÿæˆã™ã‚‹ã€ã¨ã„ã†ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã ã£ãŸ:

$$
p_\theta(x) = \int p_\theta(x \mid z) p(z) \, dz
$$

ã“ã‚Œã«å¯¾ã—ã€æœ€é©è¼¸é€ã¯ **æ½œåœ¨å¤‰æ•°ã‚’ä»‹ã•ãšã€åˆ†å¸ƒãã®ã‚‚ã®ã‚’ç›´æ¥å¤‰æ›ã™ã‚‹**:

$$
\nu = T_\sharp \mu \quad \text{(push-forward: } T \text{ ã‚’é€šã˜ã¦ } \mu \text{ ã‚’ } \nu \text{ ã«å¤‰æ›)}
$$

ã“ã‚Œã¯æ ¹æœ¬çš„ã«ç•°ãªã‚‹è¦–ç‚¹ã ã€‚VAEãŒã€Œãƒ‡ãƒ¼ã‚¿ã‚’æ½œåœ¨ç©ºé–“ã«åŸ‹ã‚è¾¼ã‚€ã€ã®ã«å¯¾ã—ã€OTã¯ã€Œãƒ‡ãƒ¼ã‚¿ç©ºé–“ã§ç›´æ¥åˆ†å¸ƒã‚’å‹•ã‹ã™ã€ã€‚

```mermaid
graph TD
    subgraph VAE Approach
        A1[ãƒ‡ãƒ¼ã‚¿ x] --> B1[Encoder q_Ï†]
        B1 --> C1[æ½œåœ¨å¤‰æ•° z]
        C1 --> D1[Decoder p_Î¸]
        D1 --> E1[å†æ§‹æˆ x']
    end

    subgraph OT Approach
        A2[åˆ†å¸ƒ Î¼] --> B2[è¼¸é€å†™åƒ T]
        B2 --> C2[åˆ†å¸ƒ Î½]
    end

    style A1 fill:#ffe0b2
    style C1 fill:#fff9c4
    style A2 fill:#e1f5fe
    style C2 fill:#c8e6c9
```

**ãªãœã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒé‡è¦ã‹ï¼Ÿ**

1. **GANã®ç†è«–åŸºç›¤**: Wasserstein GAN (WGAN) ã¯åˆ¤åˆ¥å™¨ã‚’ã€Œ1-Lipschitzé–¢æ•°ã€ã«åˆ¶ç´„ã™ã‚‹ã“ã¨ã§ã€Wassersteinè·é›¢ã‚’ç›´æ¥æœ€é©åŒ–ã™ã‚‹ [^3]
2. **Flow Matchingã®æ•°å­¦**: Rectified Flowã‚„OT-CFMã¯ã€ãƒã‚¤ã‚ºåˆ†å¸ƒã‹ã‚‰ãƒ‡ãƒ¼ã‚¿åˆ†å¸ƒã¸ã®ã€Œæœ€çŸ­çµŒè·¯ã€ã‚’å­¦ç¿’ã™ã‚‹ [^4]
3. **Diffusion Modelã®å¹¾ä½•å­¦**: Score Matchingã¯ç¢ºç‡ãƒ•ãƒ­ãƒ¼å¸¸å¾®åˆ†æ–¹ç¨‹å¼ (ODE) ã‚’é€šã˜ã¦åˆ†å¸ƒã‚’è¼¸é€ã—ã€ãã®èƒŒå¾Œã«Wassersteinå‹¾é…æµãŒã‚ã‚‹ [^5]

ã¤ã¾ã‚Šã€**2020å¹´ä»£ã®ç”Ÿæˆãƒ¢ãƒ‡ãƒ«ã®å¤§åŠãŒã€æœ€é©è¼¸é€ç†è«–ã®ä¸Šã«æ§‹ç¯‰ã•ã‚Œã¦ã„ã‚‹**ã€‚

### 2.2 æ¾å°¾ãƒ»å²©æ¾¤ç ”ã¨ã®æ¯”è¼ƒ â€” ä½•ãŒé•ã†ã®ã‹

| é …ç›® | æ¾å°¾ãƒ»å²©æ¾¤ç ” å‹•ç”»è¬›ç¾© | æœ¬ã‚·ãƒªãƒ¼ã‚º Lec 11 |
|:-----|:---------------------|:------------------|
| **OTç†è«–ã®æ‰±ã„** | GANæ–‡è„ˆã§WGANã‚’ç´¹ä»‹ï¼ˆ30åˆ†ï¼‰ | OTå˜ä½“ã§1è¬›ç¾©ï¼ˆ4000è¡Œï¼‰ã€Mongeå•é¡Œã‹ã‚‰å°å‡º |
| **Wassersteinè·é›¢** | å®šç¾©ã®ã¿ | åŒå¯¾å®šå¼åŒ–ã€å¼±åæŸã€è¨ˆé‡ç©ºé–“ã®æ€§è³ªã¾ã§å®Œå…¨å°å‡º |
| **Sinkhornç®—æ³•** | è¨€åŠãªã— | ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ–ã®ç†è«–ã€åæŸè§£æã€å®Ÿè£… |
| **Neural OT** | ãªã— | ICNNã€Monge Gapæ­£å‰‡åŒ–ã€æœ€æ–°æ‰‹æ³• (2024-2025) |
| **Flow Matchingæ¥ç¶š** | ãªã— | Rectified Flowã¨OTã®é–¢ä¿‚ã€ç¬¬36å›ã¸ã®å¸ƒçŸ³ |
| **å®Ÿè£…è¨€èª** | Python (PyTorch) ã®ã¿ | ğŸ¦€Rustä¸»å½¹ + ğŸ¦€Rust SIMDæœ€é©åŒ– |
| **æ•°å­¦çš„å³å¯†æ€§** | ç›´æ„Ÿé‡è¦– | KantorovichåŒå¯¾æ€§ã€McCannè£œé–“ã€æ¸¬åº¦è«–çš„å®šå¼åŒ– |

**æœ¬ã‚·ãƒªãƒ¼ã‚ºã®å·®åˆ¥åŒ–ãƒã‚¤ãƒ³ãƒˆ**:
- Monge (1781) â†’ Kantorovich (1942) â†’ Villani (Fields Medal 2010) â†’ Cuturi (Sinkhorn, 2013) â†’ Liu (Rectified Flow, 2022) ã¨ã„ã† **240å¹´ã®æ­´å²ã‚’ä¸€æœ¬ã®ç·š** ã§ã¤ãªã
- ç¬¬6å›ã§å­¦ã‚“ã KL divergenceã‚„f-divergenceã¨å¯¾æ¯”ã—ã€**ã€ŒãªãœWassersteinè·é›¢ãŒå¿…è¦ãªã®ã‹ã€ã‚’ç†è«–çš„ã«èª¬æ˜**
- ç¬¬36å›ã€ŒFlow Matchingçµ±ä¸€ç†è«–ã€ã§OT-CFMã€Rectified Flowã€Diffusion ODEã‚’çµ±ä¸€ã™ã‚‹å¸ƒçŸ³

### 2.3 ã“ã®ã‚³ãƒ¼ã‚¹ã«ãŠã‘ã‚‹Lecture 11ã®ä½ç½®ã¥ã‘

```mermaid
graph TD
    L6[Lec 6: KL Divergence<br/>f-Divergence] --> L9[Lec 9: å¤‰åˆ†æ¨è«–<br/>ELBO]
    L9 --> L10[Lec 10: VAE<br/>VQ-VAE]
    L6 --> L11[Lec 11: Optimal Transport<br/>Wassersteinè·é›¢]
    L11 --> L12[Lec 12: GAN<br/>WGAN]
    L11 --> L13[Lec 13: Flow Models<br/>Normalizing Flow]
    L11 --> L36[Lec 36: Flow Matching<br/>Rectified Flow]
    L10 --> L14[Lec 14: Hybrid Models<br/>VQ-GAN]
    L12 --> L14

    style L11 fill:#ffeb3b
    style L6 fill:#e1f5fe
    style L36 fill:#c8e6c9
```

**Course Iã§å­¦ã‚“ã æ•°å­¦ãŒã©ã“ã§ä½¿ã‚ã‚Œã‚‹ã‹**:

| Course Iè¬›ç¾© | Lec 11ã§ã®æ´»ç”¨ |
|:------------|:-------------|
| Lec 2: ç·šå½¢ä»£æ•° | è¼¸é€å†™åƒã®è¡Œåˆ—è¡¨ç¾ã€å…±åˆ†æ•£ã®å¹³æ–¹æ ¹ |
| Lec 3: æœ€é©åŒ– | åŒå¯¾å•é¡Œã€Lagrangeä¹—æ•°ã€KKTæ¡ä»¶ |
| Lec 4: ç¢ºç‡è«– | ç¢ºç‡æ¸¬åº¦ã€å‘¨è¾ºåˆ†å¸ƒã€çµåˆåˆ†å¸ƒ |
| Lec 5: æ¸¬åº¦è«– | Radonæ¸¬åº¦ã€push-forwardæ¸¬åº¦ã€å¼±åæŸ |
| Lec 6: æƒ…å ±ç†è«– | KL vs Wassersteinã€ãƒ¡ãƒˆãƒªã‚¼ãƒ¼ã‚·ãƒ§ãƒ³ã®é•ã„ |

**ğŸâ†’ğŸ¦€(Lec 9)â†’ğŸ¦€(Lec 10)â†’ğŸ”®(Lec 19) è¨€èªç§»è¡Œãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—**:
- **Lec 11ç¾åœ¨**: ğŸ¦€Rustä¸»å½¹ â€” æœ€é©è¼¸é€ã®æ•°å€¤è¨ˆç®—ã«æœ€é©ï¼ˆè¡Œåˆ—æ¼”ç®—ã€ã‚¼ãƒ­ã‚³ã‚¹ãƒˆæŠ½è±¡åŒ–ï¼‰
- **ğŸ¦€Rustç™»å ´**: SIMDæœ€é©åŒ–Sinkhornã€å¤§è¦æ¨¡ãƒãƒƒãƒå‡¦ç†ï¼ˆLec 11 Zone 4ï¼‰
- **ğŸ”®Elixiråˆç™»å ´**: Lec 15 Autoregressive Modelsã§åˆ†æ•£æ¨è«–

### 2.4 å­¦ç¿’æˆ¦ç•¥ â€” ã“ã®è¬›ç¾©ã‚’ã©ã†æ”»ç•¥ã™ã‚‹ã‹

**3ã¤ã®ã‚´ãƒ¼ãƒ«**:
1. **ç†è«–**: KantorovichåŒå¯¾æ€§ã‚’å®Œå…¨ç†è§£ï¼ˆGANã®Lipschitzåˆ¶ç´„ãŒãªãœå¿…è¦ã‹åˆ†ã‹ã‚‹ï¼‰
2. **å®Ÿè£…**: Sinkhornç®—æ³•ã‚’ã‚¼ãƒ­ã‹ã‚‰æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ï¼ˆRust + Rustï¼‰
3. **å¿œç”¨**: Flow Matchingã®è«–æ–‡ã§ã€ŒOT-FMã€ã€ŒRectified Flowã€ãŒå‡ºã¦ããŸã¨ãã€æ•°å¼ãŒèª­ã‚ã‚‹

**é›£æ˜“åº¦ã®å³ **:
- **å‰åŠ (Zone 0-2)**: ä½“æ„Ÿãƒ»ç›´æ„Ÿ â†’ æ¯”è¼ƒçš„ã‚¹ãƒ ãƒ¼ã‚º
- **Zone 3å‰åŠ**: Mongeå•é¡Œã€Kantorovichç·©å’Œ â†’ **æœ€åˆã®å³ **ï¼ˆå­˜åœ¨å®šç†ã€åŒå¯¾æ€§ï¼‰
- **Zone 3å¾ŒåŠ**: Wassersteinå‹¾é…æµã€McCannè£œé–“ â†’ **æœ€å¤§ã®å³ **ï¼ˆå¾®åˆ†å¹¾ä½•ã®é¦™ã‚Šï¼‰
- **Zone 4-5**: å®Ÿè£…ãƒ»å®Ÿé¨“ â†’ æ‰‹ã‚’å‹•ã‹ã›ã°ç†è§£ãŒæ·±ã¾ã‚‹

**æ¨å¥¨å­¦ç¿’é †åº**:
1. Zone 0-1ã‚’ä¸€æ°—ã«ä½“é¨“ï¼ˆ30åˆ†ï¼‰â†’ æ‰‹ã‚’å‹•ã‹ã—ã¦OTã®ã€Œæ„Ÿè§¦ã€ã‚’æ´ã‚€
2. Zone 2ã§å…¨ä½“åƒã‚’æŠŠæ¡ï¼ˆ15åˆ†ï¼‰â†’ ãªãœå­¦ã¶ã®ã‹ã‚’æ˜ç¢ºã«ã™ã‚‹
3. Zone 3ã‚’ **3æ—¥ã«åˆ†ã‘ã¦** æ”»ç•¥:
   - Day 1: Mongeå•é¡Œ + Kantorovichç·©å’Œï¼ˆÂ§3.1-3.2ã€40åˆ†ï¼‰
   - Day 2: Wassersteinè·é›¢ + åŒå¯¾æ€§ï¼ˆÂ§3.3-3.4ã€60åˆ†ï¼‰â† **æœ€é›£é–¢**
   - Day 3: Sinkhorn + å¹¾ä½•å­¦ï¼ˆÂ§3.5-3.6ã€40åˆ†ï¼‰
4. Zone 4-5ã§å®Ÿè£…ï¼ˆ90åˆ†ï¼‰â†’ ç†è«–ãŒè¡€è‚‰åŒ–ã™ã‚‹
5. Zone 6ã§ç ”ç©¶å‹•å‘ã‚’æ´ã‚€ï¼ˆ20åˆ†ï¼‰
6. Zone 7ã§å¾©ç¿’ï¼‹æ¬¡å›äºˆå‘Šï¼ˆ10åˆ†ï¼‰

**æŒ«æŠ˜ã—ãªã„ãŸã‚ã®ãƒ’ãƒ³ãƒˆ**:
- KantorovichåŒå¯¾æ€§ã§è©°ã¾ã£ãŸã‚‰ã€**ç¬¬6å›ã®KL divergenceã®åŒå¯¾è¡¨ç¾ã‚’å¾©ç¿’**ã™ã‚‹ï¼ˆåŒã˜æ§‹é€ ï¼‰
- Wassersteinå‹¾é…æµãŒé›£è§£ãªã‚‰ã€ã€ŒJKO schemeã€ã¯ç¬¬36å›ã§è©³ç´°ã«ã‚„ã‚‹ã®ã§ã€ä»Šå›ã¯ç›´æ„Ÿã ã‘ã§OK
- æ•°å¼ãŒè¿½ãˆãªããªã£ãŸã‚‰ã€**Rustã‚³ãƒ¼ãƒ‰ã‚’å…ˆã«èª­ã‚€** â†’ å…·ä½“ä¾‹ã‹ã‚‰é€†ç®—ã—ã¦æ•°å¼ã‚’ç†è§£

> **Note:** **é€²æ—: 20% å®Œäº†** ãªãœæœ€é©è¼¸é€ã‚’å­¦ã¶ã®ã‹ã€ã©ã†å­¦ã¶ã¹ãã‹ãŒæ˜ç¢ºã«ãªã£ãŸã€‚ã“ã“ã‹ã‚‰æœ¬æ ¼çš„ãªæ•°å¼ä¿®è¡Œã«å…¥ã‚‹ã€‚ãƒšãƒ³ã¨ç´™ã‚’ç”¨æ„ã—ã¦ã»ã—ã„ã€‚

> Progress: 20%
> **ç†è§£åº¦ãƒã‚§ãƒƒã‚¯**
> 1. Kantorovich-RubinsteinåŒå¯¾æ€§ $W_1(\mu, \nu) = \sup_{\|f\|_L \leq 1} \mathbb{E}_\mu[f] - \mathbb{E}_\nu[f]$ ãŒWGANã®æå¤±é–¢æ•°ã®ç†è«–çš„æ ¹æ‹ ã¨ãªã‚‹ç†ç”±ã‚’è¿°ã¹ã‚ˆã€‚
> 2. Sinkhornè·é›¢ã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ– $\text{OT}_\varepsilon(\mu, \nu) = \min_{\gamma \in \Pi(\mu,\nu)} \langle C, \gamma \rangle + \varepsilon \text{KL}(\gamma \| \mu \otimes \nu)$ ã«ãŠã„ã¦ã€$\varepsilon \to 0$ ã¨ $\varepsilon \to \infty$ ã®æ¥µé™ã§ãã‚Œãã‚Œä½•ãŒèµ·ãã‚‹ã‹èª¬æ˜ã›ã‚ˆã€‚

---

## ğŸ“ 3. æ•°å¼ä¿®è¡Œã‚¾ãƒ¼ãƒ³ï¼ˆ60åˆ†ï¼‰â€” æœ€é©è¼¸é€ç†è«–ã®å®Œå…¨å°å‡º

### 3.1 æ­´å²ã¨å•é¡Œè¨­å®š â€” Mongeå•é¡Œ (1781)

**èƒŒæ™¯**: 1781å¹´ã€ãƒ•ãƒ©ãƒ³ã‚¹ã®æ•°å­¦è€…Gaspard Mongeã¯ã€ŒåœŸã‚’æ˜ã£ã¦åˆ¥ã®å ´æ‰€ã«ç››ã‚‹ã€ã¨ã„ã†åœŸæœ¨å·¥å­¦ã®å•é¡Œã‚’å®šå¼åŒ–ã—ãŸ [^1]ã€‚ã“ã‚ŒãŒæœ€é©è¼¸é€ç†è«–ã®èµ·æºã ã€‚

#### 3.1.1 Mongeå•é¡Œã®å®šå¼åŒ–

2ã¤ã®ç¢ºç‡æ¸¬åº¦ $\mu, \nu \in \mathcal{P}(\mathbb{R}^d)$ ãŒã‚ã‚‹ã¨ãã€$\mu$ ã‚’ $\nu$ ã«ã€Œå¤‰æ›ã€ã™ã‚‹å†™åƒ $T: \mathbb{R}^d \to \mathbb{R}^d$ ã§ã€è¼¸é€ã‚³ã‚¹ãƒˆã‚’æœ€å°åŒ–ã™ã‚‹ã‚‚ã®ã‚’è¦‹ã¤ã‘ã‚ˆ:

$$
\inf_{T: T_\sharp \mu = \nu} \int_{\mathbb{R}^d} c(\boldsymbol{x}, T(\boldsymbol{x})) \, d\mu(\boldsymbol{x})
$$

**è¨˜å·ã®æ„å‘³**:

| è¨˜å· | èª­ã¿ | æ„å‘³ |
|:-----|:-----|:-----|
| $\mathcal{P}(\mathbb{R}^d)$ | ãƒ”ãƒ¼ | $\mathbb{R}^d$ ä¸Šã®ç¢ºç‡æ¸¬åº¦ã®ç©ºé–“ |
| $T_\sharp \mu$ | ãƒ†ã‚£ãƒ¼ ã‚·ãƒ£ãƒ¼ãƒ— ãƒŸãƒ¥ãƒ¼ | $T$ ã«ã‚ˆã‚‹ $\mu$ ã®push-forwardæ¸¬åº¦ |
| $c(\boldsymbol{x}, \boldsymbol{y})$ | ã‚·ãƒ¼ | ç‚¹ $\boldsymbol{x}$ ã‹ã‚‰ $\boldsymbol{y}$ ã¸ã®è¼¸é€ã‚³ã‚¹ãƒˆ |

**Push-forwardæ¸¬åº¦** $T_\sharp \mu$ ã®å®šç¾©:

$$
(T_\sharp \mu)(A) := \mu(T^{-1}(A)) \quad \text{for any Borel set } A
$$

ã€Œ$T$ ã§ç‚¹ã‚’ç§»ã—ãŸå¾Œã€é›†åˆ $A$ ã«å«ã¾ã‚Œã‚‹è³ªé‡ã€= ã€Œå…ƒã®ç©ºé–“ã§ $T^{-1}(A)$ ã«å«ã¾ã‚Œã¦ã„ãŸè³ªé‡ã€ã€‚ã“ã‚ŒãŒ $T_\sharp \mu = \nu$ ã¨ã„ã†åˆ¶ç´„ã ã€‚

**ã‚³ã‚¹ãƒˆé–¢æ•°ã®ä¾‹**:
- **ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢ã®2ä¹—**: $c(\boldsymbol{x}, \boldsymbol{y}) = \|\boldsymbol{x} - \boldsymbol{y}\|^2$ â† æœ€ã‚‚æ¨™æº–çš„
- **ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢**: $c(\boldsymbol{x}, \boldsymbol{y}) = \|\boldsymbol{x} - \boldsymbol{y}\|$
- **æŒ‡ç¤ºé–¢æ•°**: $c(\boldsymbol{x}, \boldsymbol{y}) = \mathbb{1}_{\{\boldsymbol{x} \neq \boldsymbol{y}\}}$ ï¼ˆç•°ãªã‚‹ç‚¹ã¸ã®è¼¸é€ã¯å¸¸ã«ã‚³ã‚¹ãƒˆ1ï¼‰

#### 3.1.2 Mongeå•é¡Œã®å›°é›£æ€§

Mongeå•é¡Œã¯ä¸€è¦‹ã‚·ãƒ³ãƒ—ãƒ«ã ãŒã€æ¬¡ã®ç†ç”±ã§è§£ãã®ãŒé›£ã—ã„:

1. **å†™åƒ $T$ ã®å­˜åœ¨æ€§**: $\mu$ ãŒé›¢æ•£æ¸¬åº¦ï¼ˆä¾‹: $\mu = \sum_{i=1}^n p_i \delta_{x_i}$ï¼‰ã§ã€$\nu$ ãŒé€£ç¶šæ¸¬åº¦ã®ã¨ãã€$T_\sharp \mu = \nu$ ã‚’æº€ãŸã™ $T$ ã¯ **å­˜åœ¨ã—ãªã„**
   - é›¢æ•£çš„ãªè³ªé‡ã‚’é€£ç¶šçš„ã«ã€Œã°ã‚‰æ’’ãã€ã“ã¨ã¯ã§ããªã„ï¼ˆ1ç‚¹ã‚’è¤‡æ•°ç‚¹ã«åˆ†å‰²ã§ããªã„ï¼‰

2. **éå‡¸æ€§**: å†™åƒã®é›†åˆ $\{T : T_\sharp \mu = \nu\}$ ã¯å‡¸é›†åˆã§ã¯ãªã„
   - 2ã¤ã®å†™åƒ $T_1, T_2$ ãŒåˆ¶ç´„ã‚’æº€ãŸã—ã¦ã‚‚ã€$\alpha T_1 + (1-\alpha) T_2$ ã¯æº€ãŸã•ãªã„

3. **éç·šå½¢åˆ¶ç´„**: Push-forwardæ¡ä»¶ $T_\sharp \mu = \nu$ ã¯éç·šå½¢

ã“ã‚Œã‚‰ã‚’è§£æ±ºã—ãŸã®ãŒ **Kantorovichç·©å’Œ** (1942) ã ã€‚

### 3.2 Kantorovichç·©å’Œ â€” ç·šå½¢è¨ˆç”»å•é¡Œã¸ã®å¤‰æ›

#### 3.2.1 è¼¸é€è¨ˆç”»ã®å°å…¥

Mongeã¯ã€Œå„ç‚¹ $\boldsymbol{x}$ ã‚’ **1ã¤ã®ç‚¹** $T(\boldsymbol{x})$ ã«é€ã‚‹ã€ã¨è€ƒãˆãŸï¼ˆæ±ºå®šè«–çš„ï¼‰ã€‚Kantorovichã¯ã“ã‚Œã‚’ç·©å’Œã—ã€ã€Œå„ç‚¹ $\boldsymbol{x}$ ã‚’ **è¤‡æ•°ã®ç‚¹ã«ç¢ºç‡çš„ã«åˆ†é…**ã—ã¦ã‚‚ã‚ˆã„ã€ã¨ã—ãŸï¼ˆç¢ºç‡çš„ï¼‰ã€‚

**è¼¸é€è¨ˆç”»** (transport plan) $\gamma \in \Pi(\mu, \nu)$ ã‚’å°å…¥:

$$
\Pi(\mu, \nu) := \left\{ \gamma \in \mathcal{P}(\mathbb{R}^d \times \mathbb{R}^d) \;\middle|\; (\pi^1)_\sharp \gamma = \mu, \; (\pi^2)_\sharp \gamma = \nu \right\}
$$

ã“ã“ã§ $\pi^1, \pi^2$ ã¯å°„å½±:
- $\pi^1(\boldsymbol{x}, \boldsymbol{y}) = \boldsymbol{x}$ ï¼ˆç¬¬1æˆåˆ†ã¸ã®å°„å½±ï¼‰
- $\pi^2(\boldsymbol{x}, \boldsymbol{y}) = \boldsymbol{y}$ ï¼ˆç¬¬2æˆåˆ†ã¸ã®å°„å½±ï¼‰

æ¡ä»¶ $(\pi^1)_\sharp \gamma = \mu$ ã¯ã€Œ$\gamma$ ã® $\boldsymbol{x}$-å‘¨è¾ºåˆ†å¸ƒãŒ $\mu$ã€ã€$(\pi^2)_\sharp \gamma = \nu$ ã¯ã€Œ$\gamma$ ã® $\boldsymbol{y}$-å‘¨è¾ºåˆ†å¸ƒãŒ $\nu$ã€ã‚’æ„å‘³ã™ã‚‹ã€‚

**ç›´æ„Ÿ**: $\gamma(\boldsymbol{x}, \boldsymbol{y})$ ã¯ã€Œç‚¹ $\boldsymbol{x}$ ã‹ã‚‰ç‚¹ $\boldsymbol{y}$ ã¸ã©ã‚Œã ã‘ã®è³ªé‡ã‚’é€ã‚‹ã‹ã€ã‚’è¡¨ã™çµåˆåˆ†å¸ƒã ã€‚

#### 3.2.2 Kantorovichå•é¡Œã®å®šå¼åŒ–

$$
W_c(\mu, \nu) := \inf_{\gamma \in \Pi(\mu, \nu)} \int_{\mathbb{R}^d \times \mathbb{R}^d} c(\boldsymbol{x}, \boldsymbol{y}) \, d\gamma(\boldsymbol{x}, \boldsymbol{y})
$$

**Mongeå•é¡Œã¨ã®é–¢ä¿‚**:
- Monge: å†™åƒ $T$ ã‚’æ¢ã™ï¼ˆæ±ºå®šè«–çš„è¼¸é€ï¼‰
- Kantorovich: çµåˆæ¸¬åº¦ $\gamma$ ã‚’æ¢ã™ï¼ˆç¢ºç‡çš„è¼¸é€ï¼‰
- Mongeã®è§£ $T$ ã¯ã€$\gamma = (\text{id}, T)_\sharp \mu$ ã¨ã„ã†ç‰¹æ®Šãª $\gamma$ ã«å¯¾å¿œ
  - $(\text{id}, T)_\sharp \mu$ ã¯ã€Œç‚¹ $\boldsymbol{x}$ ã‚’ç¢ºç‡1ã§ $T(\boldsymbol{x})$ ã«é€ã‚‹ã€ã¨ã„ã†æ±ºå®šè«–çš„è¨ˆç”»

ã—ãŸãŒã£ã¦:

$$
W_c(\mu, \nu) \leq \inf_{T: T_\sharp \mu = \nu} \int c(\boldsymbol{x}, T(\boldsymbol{x})) \, d\mu(\boldsymbol{x})
$$

ç­‰å·ãŒæˆç«‹ã™ã‚‹ã®ã¯ã€Œæœ€é©è¼¸é€è¨ˆç”»ãŒæ±ºå®šè«–çš„ï¼ˆMongeè§£ï¼‰ã®ã¨ãã€ã ã€‚

#### 3.2.3 é›¢æ•£æ¸¬åº¦ã®å ´åˆ: ç·šå½¢è¨ˆç”»å•é¡Œ

$\mu = \sum_{i=1}^n p_i \delta_{x_i}$, $\nu = \sum_{j=1}^m q_j \delta_{y_j}$ ã®ã¨ãã€$\gamma$ ã¯è¡Œåˆ— $\boldsymbol{\Gamma} = (\gamma_{ij})$ ã§è¡¨ã•ã‚Œã‚‹:

$$
\min_{\boldsymbol{\Gamma} \in \mathbb{R}_+^{n \times m}} \sum_{i=1}^n \sum_{j=1}^m C_{ij} \gamma_{ij}
$$

$$
\text{subject to} \quad \sum_{j=1}^m \gamma_{ij} = p_i \; (i=1,\ldots,n), \quad \sum_{i=1}^n \gamma_{ij} = q_j \; (j=1,\ldots,m)
$$

ã“ã“ã§ $C_{ij} = c(x_i, y_j)$ ã¯ã‚³ã‚¹ãƒˆè¡Œåˆ—ã€‚

**ã“ã‚Œã¯æ¨™æº–çš„ãªç·šå½¢è¨ˆç”»å•é¡Œ** â†’ å˜ä½“æ³•ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§è§£ã‘ã‚‹ï¼ˆè¨ˆç®—é‡ $O(n^3 \log n)$ ç¨‹åº¦ï¼‰ã€‚

**æ•°å€¤ä¾‹ã§ç¢ºèª**:


å‡ºåŠ›:


**Zone 1ã§è¦‹ãŸGreedyè¿‘ä¼¼ï¼ˆcost=0.575ï¼‰ã‚ˆã‚Šå¤§å¹…ã«æ”¹å–„**ã€‚ç·šå½¢è¨ˆç”»æ³•ã¯ **çœŸã®æœ€é©è§£** ã‚’ä¸ãˆã‚‹ã€‚

#### 3.2.4 KantorovichåŒå¯¾å•é¡Œ

ç·šå½¢è¨ˆç”»å•é¡Œã«ã¯ **åŒå¯¾å•é¡Œ** ãŒã‚ã‚‹ï¼ˆç¬¬3å›ã®æœ€é©åŒ–ç†è«–ï¼‰ã€‚Kantorovichå•é¡Œã®åŒå¯¾ã¯:

$$
\sup_{\phi, \psi} \left\{ \int \phi(\boldsymbol{x}) \, d\mu(\boldsymbol{x}) + \int \psi(\boldsymbol{y}) \, d\nu(\boldsymbol{y}) \;\middle|\; \phi(\boldsymbol{x}) + \psi(\boldsymbol{y}) \leq c(\boldsymbol{x}, \boldsymbol{y}) \right\}
$$

**ç›´æ„Ÿ**: $\phi(\boldsymbol{x})$ ã¯ã€Œç‚¹ $\boldsymbol{x}$ ã§ã®ä¾¡æ ¼ã€ã€$\psi(\boldsymbol{y})$ ã¯ã€Œç‚¹ $\boldsymbol{y}$ ã§ã®ä¾¡æ ¼ã€ã€‚åˆ¶ç´„ $\phi(\boldsymbol{x}) + \psi(\boldsymbol{y}) \leq c(\boldsymbol{x}, \boldsymbol{y})$ ã¯ã€Œè²·å€¤+å£²å€¤ â‰¤ è¼¸é€ã‚³ã‚¹ãƒˆã€ã‚’æ„å‘³ã™ã‚‹ï¼ˆarbitrageä¸åœ¨æ¡ä»¶ï¼‰ã€‚

**å¼·åŒå¯¾æ€§** (Kantorovich-Rubinsteinå®šç†):

$$
\inf_{\gamma \in \Pi(\mu, \nu)} \int c \, d\gamma = \sup_{\phi, \psi: \phi \oplus \psi \leq c} \left( \int \phi \, d\mu + \int \psi \, d\nu \right)
$$

ã“ã“ã§ $\phi \oplus \psi \leq c$ ã¯ $\phi(\boldsymbol{x}) + \psi(\boldsymbol{y}) \leq c(\boldsymbol{x}, \boldsymbol{y})$ ã®ç•¥è¨˜ã€‚

**ãªãœåŒå¯¾æ€§ãŒé‡è¦ã‹ï¼Ÿ**
- **WGAN**: åˆ¤åˆ¥å™¨ãŒ $\phi$ ã«å¯¾å¿œã—ã€Lipschitzåˆ¶ç´„ãŒ $c$-transformæ¡ä»¶ã«å¯¾å¿œã™ã‚‹ [^3]
- **Neural OT**: $\phi$ ã‚’ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆã§è¿‘ä¼¼ã—ã€åŒå¯¾å•é¡Œã‚’ç›´æ¥æœ€é©åŒ–ã™ã‚‹æ‰‹æ³•ãŒã‚ã‚‹

### 3.3 Wassersteinè·é›¢ â€” ç¢ºç‡æ¸¬åº¦ç©ºé–“ã®è·é›¢

#### 3.3.1 å®šç¾©

ã‚³ã‚¹ãƒˆé–¢æ•° $c(\boldsymbol{x}, \boldsymbol{y}) = \|\boldsymbol{x} - \boldsymbol{y}\|^p$ ã®ã¨ãã€**$p$-Wassersteinè·é›¢** ã‚’å®šç¾©:

$$
W_p(\mu, \nu) := \left( \inf_{\gamma \in \Pi(\mu, \nu)} \int \|\boldsymbol{x} - \boldsymbol{y}\|^p \, d\gamma(\boldsymbol{x}, \boldsymbol{y}) \right)^{1/p}
$$

æœ€ã‚‚ä¸€èˆ¬çš„ãªã®ã¯ **2-Wassersteinè·é›¢** ($p=2$):

$$
W_2^2(\mu, \nu) = \inf_{\gamma \in \Pi(\mu, \nu)} \int \|\boldsymbol{x} - \boldsymbol{y}\|^2 \, d\gamma(\boldsymbol{x}, \boldsymbol{y})
$$

**åˆ¥å**: Earth Mover's Distance (EMD)ã€Kantorovichè·é›¢ã€Mallowsè·é›¢

#### 3.3.2 è·é›¢ã®å…¬ç†ã‚’æº€ãŸã™ã“ã¨ã®è¨¼æ˜

$W_p$ ãŒè·é›¢ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ï¼ˆ$p \geq 1$ ã®ã¨ãï¼‰:

**1. éè² æ€§**: $W_p(\mu, \nu) \geq 0$
- æ˜ã‚‰ã‹ï¼ˆç©åˆ†ãŒéè² ï¼‰

**2. åŒä¸€å¾‹**: $W_p(\mu, \nu) = 0 \Leftrightarrow \mu = \nu$
- $(\Rightarrow)$: $W_p(\mu, \nu) = 0$ ãªã‚‰ã€æœ€é©è¨ˆç”» $\gamma^*$ ã§ $\int \|\boldsymbol{x} - \boldsymbol{y}\|^p d\gamma^* = 0$
  - ã“ã‚Œã¯ $\gamma^*$ ãŒå¯¾è§’ç·š $\{(\boldsymbol{x}, \boldsymbol{x})\}$ ä¸Šã«é›†ä¸­ã™ã‚‹ã“ã¨ã‚’æ„å‘³
  - ã‚ˆã£ã¦ $\gamma^* = \mu \otimes \delta_{\boldsymbol{x}}$ ã®å½¢ã«ãªã‚Šã€$\mu = \nu$
- $(\Leftarrow)$: $\mu = \nu$ ãªã‚‰ $\gamma = \text{diag}(\mu)$ ï¼ˆå¯¾è§’æ¸¬åº¦ï¼‰ãŒåˆ¶ç´„ã‚’æº€ãŸã—ã€ã‚³ã‚¹ãƒˆã¯0

**3. å¯¾ç§°æ€§**: $W_p(\mu, \nu) = W_p(\nu, \mu)$
- $\gamma \in \Pi(\mu, \nu)$ ãªã‚‰ $\tilde{\gamma}(\boldsymbol{x}, \boldsymbol{y}) := \gamma(\boldsymbol{y}, \boldsymbol{x})$ ã¯ $\Pi(\nu, \mu)$ ã«å±ã™ã‚‹
- ã‚³ã‚¹ãƒˆé–¢æ•°ãŒå¯¾ç§° $c(\boldsymbol{x}, \boldsymbol{y}) = c(\boldsymbol{y}, \boldsymbol{x})$ ãªã‚‰ã€$W_p(\mu, \nu) = W_p(\nu, \mu)$

**4. ä¸‰è§’ä¸ç­‰å¼**: $W_p(\mu, \rho) \leq W_p(\mu, \nu) + W_p(\nu, \rho)$
- **Gluing Lemma** (æ¥ç€è£œé¡Œ) ã‚’ä½¿ã†:
  - $\gamma_1 \in \Pi(\mu, \nu)$, $\gamma_2 \in \Pi(\nu, \rho)$ ãŒã‚ã‚Œã°ã€$\gamma \in \Pi(\mu, \rho)$ ã§
    $$\gamma(A \times C) = \int \gamma_1(A \times \{y\}) \gamma_2(\{y\} \times C) \, d\nu(y)$$
    ã‚’æº€ãŸã™ã‚‚ã®ãŒå­˜åœ¨ã™ã‚‹
  - ã“ã® $\gamma$ ã«å¯¾ã—ã€Minkowskiä¸ç­‰å¼ã‚ˆã‚Š
    $$W_p(\mu, \rho) \leq \left( \int \|\boldsymbol{x} - \boldsymbol{z}\|^p d\gamma \right)^{1/p} \leq W_p(\mu, \nu) + W_p(\nu, \rho)$$

ã—ãŸãŒã£ã¦ $W_p$ ã¯ $\mathcal{P}_p(\mathbb{R}^d)$ ä¸Šã®è·é›¢ã§ã‚ã‚‹ï¼ˆã“ã“ã§ $\mathcal{P}_p$ ã¯ $p$-æ¬¡ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆãŒæœ‰é™ãªæ¸¬åº¦ã®ç©ºé–“ï¼‰ã€‚

#### 3.3.3 Wassersteinè·é›¢ã¨å¼±åæŸ

**å®šç†** (Wassersteinè·é›¢ã¨å¼±åæŸã®åŒå€¤æ€§):

ç¢ºç‡æ¸¬åº¦ã®åˆ— $\{\mu_n\}$ ãŒ $\mu$ ã«å¼±åæŸã™ã‚‹ ($\mu_n \xrightarrow{w} \mu$) ã“ã¨ã¨ã€$W_p(\mu_n, \mu) \to 0$ ã‹ã¤ $p$-æ¬¡ãƒ¢ãƒ¼ãƒ¡ãƒ³ãƒˆãŒä¸€æ§˜æœ‰ç•Œã§ã‚ã‚‹ã“ã¨ã¯åŒå€¤ã€‚

**å¼±åæŸã®å®šç¾©**: ä»»æ„ã®æœ‰ç•Œé€£ç¶šé–¢æ•° $f$ ã«å¯¾ã—ã€$\int f d\mu_n \to \int f d\mu$

**ãªãœé‡è¦ã‹ï¼Ÿ**:
- KL divergence $D_{\text{KL}}(\mu_n \| \mu)$ ã¯ã€$\mu_n$ ã¨ $\mu$ ã®ã‚µãƒãƒ¼ãƒˆãŒé‡ãªã‚‰ãªã„ã¨ $+\infty$ ã«ãªã‚‹ï¼ˆç¬¬6å›ï¼‰
- Wassersteinè·é›¢ã¯ **ã‚µãƒãƒ¼ãƒˆãŒé›¢ã‚Œã¦ã„ã¦ã‚‚æœ‰é™å€¤** ã‚’å–ã‚Šã€åæŸã‚’æ¤œå‡ºã§ãã‚‹

**å…·ä½“ä¾‹**:


å‡ºåŠ›:


**$W_2(\mu_n, \mu) \to 0$ ãŒç¢ºèªã§ãã‚‹ã€‚** ã“ã‚Œã¯å¼±åæŸã®ååˆ†æ¡ä»¶ã ã€‚

### 3.4 Kantorovich-RubinsteinåŒå¯¾æ€§ â€” WGANç†è«–ã®åŸºç›¤

#### 3.4.1 1-Wassersteinè·é›¢ã®åŒå¯¾è¡¨ç¾

$p=1$ ã®å ´åˆã€åŒå¯¾è¡¨ç¾ãŒç‰¹ã«ã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹:

$$
W_1(\mu, \nu) = \sup_{\|f\|_L \leq 1} \left( \int f(\boldsymbol{x}) \, d\mu(\boldsymbol{x}) - \int f(\boldsymbol{y}) \, d\nu(\boldsymbol{y}) \right)
$$

ã“ã“ã§ $\|f\|_L \leq 1$ ã¯ **1-Lipschitzæ¡ä»¶**:

$$
|f(\boldsymbol{x}) - f(\boldsymbol{y})| \leq \|\boldsymbol{x} - \boldsymbol{y}\| \quad \text{for all } \boldsymbol{x}, \boldsymbol{y}
$$

**è¨¼æ˜ã®ã‚¹ã‚±ãƒƒãƒ**:

åŒå¯¾å•é¡Œ $\sup \{\int \phi d\mu + \int \psi d\nu \mid \phi \oplus \psi \leq c\}$ ã«ãŠã„ã¦ã€$c(\boldsymbol{x}, \boldsymbol{y}) = \|\boldsymbol{x} - \boldsymbol{y}\|$ ã®ã¨ã:

1. **$c$-transform**: $\phi^c(\boldsymbol{y}) := \inf_{\boldsymbol{x}} (c(\boldsymbol{x}, \boldsymbol{y}) - \phi(\boldsymbol{x}))$
   - æœ€é©ãª $\psi$ ã¯ $\psi = \phi^c$ ã®å½¢ã«ãªã‚‹

2. **é–¢æ•°ã®åˆ¶ç´„**: $\phi \oplus \phi^c \leq c$ ã¯ã€$\phi$ ãŒ1-Lipschitzã§ã‚ã‚‹ã“ã¨ã¨åŒå€¤
   - ãªãœãªã‚‰ $|\phi(\boldsymbol{x}) - \phi(\boldsymbol{y})| \leq c(\boldsymbol{x}, \boldsymbol{y}) = \|\boldsymbol{x} - \boldsymbol{y}\|$

3. **å˜ä¸€é–¢æ•°ã§ã®è¡¨ç¾**: $f := \phi$ ã¨ãŠãã¨
   $$\int \phi d\mu + \int \phi^c d\nu = \int f d\mu - \int f d\nu$$
   ï¼ˆç¬¬2é …ã®ç¬¦å·ãŒå¤‰ã‚ã‚‹ã®ã¯ $\phi^c(\boldsymbol{y}) = -\phi(\boldsymbol{y})$ ã®å½¢ã«ãªã‚‹ãŸã‚ï¼‰

**WGANã¨ã®æ¥ç¶š**:

WGAN [^3] ã®åˆ¤åˆ¥å™¨ã¯æ¬¡ã‚’æœ€å¤§åŒ–ã™ã‚‹:

$$
\max_{D: \|D\|_L \leq 1} \left( \mathbb{E}_{\boldsymbol{x} \sim p_{\text{data}}}[D(\boldsymbol{x})] - \mathbb{E}_{\boldsymbol{x} \sim p_G}[D(\boldsymbol{x})] \right)
$$

ã“ã‚Œã¯ **ã¾ã•ã« $W_1(p_{\text{data}}, p_G)$ ã®åŒå¯¾è¡¨ç¾**ï¼

1-Lipschitzåˆ¶ç´„ã¯ã€WGANã§ã¯æ¬¡ã®æ‰‹æ³•ã§å®Ÿç¾:
- **Weight clipping**: $\text{clip}(w, -c, c)$ï¼ˆå…ƒè«–æ–‡ã€ä¸å®‰å®šï¼‰
- **Gradient penalty**: $\lambda \mathbb{E}[(\|\nabla_{\boldsymbol{x}} D(\boldsymbol{x})\| - 1)^2]$ (WGAN-GP [^6]ã€æ¨™æº–)
- **Spectral normalization**: å„å±¤ã®é‡ã¿è¡Œåˆ—ã®ã‚¹ãƒšã‚¯ãƒˆãƒ«ãƒãƒ«ãƒ ã‚’1ã«æ­£è¦åŒ– (SN-GAN [^7])

#### 3.4.2 2-Wassersteinè·é›¢ã®åŒå¯¾è¡¨ç¾

$p=2$ ã®å ´åˆã€åŒå¯¾è¡¨ç¾ã¯:

$$
W_2^2(\mu, \nu) = \sup_{\phi \in C^1} \left( \int \phi(\boldsymbol{x}) \, d\mu(\boldsymbol{x}) - \int \phi^*(\boldsymbol{y}) \, d\nu(\boldsymbol{y}) \right)
$$

ã“ã“ã§ $\phi^*$ ã¯ **å‡¸å…±å½¹** (Legendre-Fenchel transform):

$$
\phi^*(\boldsymbol{y}) = \sup_{\boldsymbol{x}} \left( \langle \boldsymbol{y}, \boldsymbol{x} \rangle - \phi(\boldsymbol{x}) \right)
$$

**æ¡ä»¶**: $\phi$ ã¯å‡¸é–¢æ•°ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ï¼ˆã¾ãŸã¯å‡¹é–¢æ•°ã§é©åˆ‡ã«ç¬¦å·ã‚’èª¿æ•´ï¼‰ã€‚

**æœ€é©è¼¸é€å†™åƒã¨ã®é–¢ä¿‚**:

$\phi$ ãŒå‡¸é–¢æ•°ã®ã¨ãã€æœ€é©è¼¸é€å†™åƒã¯ $T(\boldsymbol{x}) = \nabla \phi(\boldsymbol{x})$ ï¼ˆBrenierå®šç† [^2]ï¼‰ã€‚

ã“ã‚ŒãŒ **Input-Convex Neural Networks (ICNN)** [^8] ã®å‹•æ©Ÿã :
- ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆã§å‡¸é–¢æ•° $\phi$ ã‚’è¡¨ç¾
- ãã®å‹¾é… $\nabla \phi$ ãŒæœ€é©è¼¸é€å†™åƒã«ãªã‚‹

### 3.5 Sinkhornè·é›¢ â€” ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ–OT

#### 3.5.1 ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ–ã®å‹•æ©Ÿ

Kantorovichå•é¡Œã®è¨ˆç®—é‡ã¯ $O(n^3 \log n)$ ï¼ˆ$n$ = ãƒ‡ãƒ¼ã‚¿ç‚¹æ•°ï¼‰ã€‚å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§ã¯ç¾å®Ÿçš„ã§ãªã„ã€‚

**Cuturi (2013) [^9] ã®ç™ºè¦‹**: ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼é …ã‚’åŠ ãˆã‚‹ã¨ã€**Sinkhornã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **ï¼ˆè¡Œåˆ—ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ï¼‰ã§ $O(n^2)$ åå¾©ã§è§£ã‘ã‚‹ã€‚

**ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ–OT**:

$$
W_c^\varepsilon(\mu, \nu) := \min_{\gamma \in \Pi(\mu, \nu)} \left\{ \int c \, d\gamma - \varepsilon H(\gamma) \right\}
$$

ã“ã“ã§ $H(\gamma)$ ã¯ **ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼**:

$$
H(\gamma) := -\int_{\mathbb{R}^d \times \mathbb{R}^d} \log \frac{d\gamma}{d(\mu \otimes \nu)} \, d\gamma
$$

é›¢æ•£ã®å ´åˆ:

$$
H(\boldsymbol{\Gamma}) = -\sum_{i,j} \gamma_{ij} \log \frac{\gamma_{ij}}{p_i q_j}
$$

#### 3.5.2 æœ€é©è§£ã®å½¢

**å®šç†**: ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ–OTã®æœ€é©è§£ã¯æ¬¡ã®å½¢ã‚’æŒã¤:

$$
\gamma_{ij}^* = u_i K_{ij} v_j
$$

ã“ã“ã§:
- $\boldsymbol{K} = \exp(-\boldsymbol{C} / \varepsilon)$ ã¯ **Gibbsã‚«ãƒ¼ãƒãƒ«**
- $\boldsymbol{u}, \boldsymbol{v}$ ã¯å‘¨è¾ºåˆ¶ç´„ã‚’æº€ãŸã™ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ™ã‚¯ãƒˆãƒ«:
  $$\boldsymbol{K} \boldsymbol{v} \odot \boldsymbol{u} = \boldsymbol{p}, \quad \boldsymbol{K}^\top \boldsymbol{u} \odot \boldsymbol{v} = \boldsymbol{q}$$
  ï¼ˆ$\odot$ ã¯è¦ç´ ã”ã¨ã®ç©ï¼‰

**è¨¼æ˜**: Lagrangeä¹—æ•°æ³•ã‚’ä½¿ã†ã€‚

ç›®çš„é–¢æ•°:

$$
\mathcal{L} = \sum_{ij} \gamma_{ij} C_{ij} + \varepsilon \sum_{ij} \gamma_{ij} \log \frac{\gamma_{ij}}{p_i q_j} - \sum_i \alpha_i \left( \sum_j \gamma_{ij} - p_i \right) - \sum_j \beta_j \left( \sum_i \gamma_{ij} - q_j \right)
$$

$\gamma_{ij}$ ã§åå¾®åˆ†:

$$
\frac{\partial \mathcal{L}}{\partial \gamma_{ij}} = C_{ij} + \varepsilon \left( \log \frac{\gamma_{ij}}{p_i q_j} + 1 \right) - \alpha_i - \beta_j = 0
$$

ã“ã‚Œã‚’ $\gamma_{ij}$ ã«ã¤ã„ã¦è§£ãã¨:

$$
\gamma_{ij} = p_i q_j \exp\left( \frac{\alpha_i + \beta_j - C_{ij} - \varepsilon}{\varepsilon} \right)
$$

$u_i := e^{\alpha_i / \varepsilon}$, $v_j := e^{(\beta_j - \varepsilon) / \varepsilon}$, $K_{ij} := e^{-C_{ij} / \varepsilon}$ ã¨ãŠãã¨:

$$
\gamma_{ij} = u_i K_{ij} v_j \cdot p_i q_j
$$

æ­£ã—ãã¯ $\boldsymbol{\Gamma} = \text{diag}(\boldsymbol{u}) \boldsymbol{K} \text{diag}(\boldsymbol{v})$ ã§ã€å‘¨è¾ºåˆ¶ç´„ã‹ã‚‰ $\boldsymbol{u}, \boldsymbol{v}$ ã‚’æ±‚ã‚ã‚‹ã€‚

#### 3.5.3 Sinkhornã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 

**ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ **:


**Rustå®Ÿè£…ï¼ˆZone 1ã‚ˆã‚Šè©³ç´°ç‰ˆï¼‰**:


å‡ºåŠ›:


**è¦³å¯Ÿ**:
- $\varepsilon$ ãŒå°ã•ã„ã»ã©å…ƒã®OTã«è¿‘ã„ï¼ˆã‚³ã‚¹ãƒˆãŒå°ã•ã„ï¼‰ãŒã€åæŸãŒé…ã„
- $\varepsilon$ ãŒå¤§ãã„ã»ã©é«˜é€Ÿã ãŒã€ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼é …ã®å½±éŸ¿ã§è¨ˆç”»ãŒã€Œã¼ã‚„ã‘ã‚‹ã€

#### 3.5.4 è¨ˆç®—é‡è§£æ

**1åå¾©ã®è¨ˆç®—é‡**: $O(nm)$ ï¼ˆè¡Œåˆ—-ãƒ™ã‚¯ãƒˆãƒ«ç© $\boldsymbol{K} \boldsymbol{v}$ï¼‰

**åæŸåå¾©æ•°**: ç†è«–çš„ã«ã¯ $O(\varepsilon^{-3})$ ã ãŒã€å®Ÿç”¨ä¸Šã¯ $O(\varepsilon^{-1})$ ç¨‹åº¦

**ç·è¨ˆç®—é‡**: $O(n^2 \varepsilon^{-1})$ â† ç·šå½¢è¨ˆç”»æ³•ã® $O(n^3 \log n)$ ã‚ˆã‚Šå¤§å¹…ã«é«˜é€Ÿ

**å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã¸ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°**:
- **Mini-batch Sinkhorn**: ãƒãƒƒãƒã”ã¨ã«è¨ˆç®—ã€å‹¾é…ã‚’é›†ç´„
- **Low-rank approximation**: $\boldsymbol{K} \approx \boldsymbol{U} \boldsymbol{V}^\top$ ã§ $O(nr)$ ã«å‰Šæ¸›ï¼ˆ$r$ = rankï¼‰
- **Screened Sinkhorn**: $K_{ij}$ ãŒå°ã•ã„è¦ç´ ã‚’åˆ‡ã‚Šæ¨ã¦ï¼ˆã‚¹ãƒ‘ãƒ¼ã‚¹åŒ–ï¼‰

### 3.6 æœ€é©è¼¸é€ã®å¹¾ä½•å­¦ â€” McCannè£œé–“ã¨Displacement Convexity

#### 3.6.1 ç¢ºç‡æ¸¬åº¦ç©ºé–“ã®å¹¾ä½•å­¦

$(\mathcal{P}_2(\mathbb{R}^d), W_2)$ ã¯ **æ¸¬åœ°è·é›¢ç©ºé–“** (geodesic metric space) ã«ãªã‚‹ã€‚

**McCannè£œé–“**: $\mu_0, \mu_1 \in \mathcal{P}_2(\mathbb{R}^d)$ ã«å¯¾ã—ã€2ã¤ã®æ¸¬åº¦ã‚’ã€Œè£œé–“ã€ã™ã‚‹æ›²ç·š $\{\mu_t\}_{t \in [0,1]}$ ã‚’å®šç¾©:

$$
\mu_t := ((1-t) \text{id} + t T)_\sharp \mu_0
$$

ã“ã“ã§ $T$ ã¯ $\mu_0$ ã‹ã‚‰ $\mu_1$ ã¸ã®æœ€é©è¼¸é€å†™åƒï¼ˆ$T_\sharp \mu_0 = \mu_1$ï¼‰ã€‚

**æ€§è³ª**: $W_2(\mu_0, \mu_t) = t \cdot W_2(\mu_0, \mu_1)$ï¼ˆæ¸¬åœ°ç·šï¼‰

**ç›´æ„Ÿ**: å„ç‚¹ $\boldsymbol{x}$ ã‚’ç›´ç·šçš„ã« $T(\boldsymbol{x})$ ã«å‹•ã‹ã™ã¨ãã€æ™‚åˆ» $t$ ã§ã®ç‚¹ã®åˆ†å¸ƒãŒ $\mu_t$ã€‚

**ã‚¬ã‚¦ã‚¹åˆ†å¸ƒã®ä¾‹**:

$\mu_0 = \mathcal{N}(\boldsymbol{m}_0, \Sigma_0)$, $\mu_1 = \mathcal{N}(\boldsymbol{m}_1, \Sigma_1)$ ã®ã¨ãã€è£œé–“ã¯:

$$
\mu_t = \mathcal{N}(\boldsymbol{m}_t, \Sigma_t)
$$

$$
\boldsymbol{m}_t = (1-t) \boldsymbol{m}_0 + t \boldsymbol{m}_1
$$

$$
\Sigma_t = (1-t)^2 \Sigma_0 + t^2 \Sigma_1 + t(1-t) \left( \Sigma_0^{1/2} \Sigma_1 \Sigma_0^{1/2} \right)^{1/2} + \text{(symmetric term)}
$$

ï¼ˆæ­£ç¢ºãªå…¬å¼ã¯è¤‡é›‘ã ãŒã€æœ¬è³ªã¯ã€Œå…±åˆ†æ•£ã‚‚è£œé–“ã•ã‚Œã‚‹ã€ï¼‰

#### 3.6.2 Displacement Convexity

æ±é–¢æ•° $\mathcal{F}: \mathcal{P}_2(\mathbb{R}^d) \to \mathbb{R}$ ãŒ **displacement convex** ã¨ã¯:

$$
\mathcal{F}(\mu_t) \leq (1-t) \mathcal{F}(\mu_0) + t \mathcal{F}(\mu_1)
$$

ãŒä»»æ„ã®æ¸¬åœ°ç·š $\mu_t$ ã«å¯¾ã—ã¦æˆç«‹ã™ã‚‹ã“ã¨ã€‚

**ä¾‹ï¼ˆã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼ï¼‰**: $\mathcal{F}(\mu) = \int \mu \log \mu$ ã¯ displacement convex

**å¿œç”¨ï¼ˆWassersteinå‹¾é…æµï¼‰**: æ±é–¢æ•°ã‚’ $W_2$ ã®æ„å‘³ã§ã€Œå‹¾é…é™ä¸‹ã€ã™ã‚‹ã¨ã€é‡è¦ãªåå¾®åˆ†æ–¹ç¨‹å¼ãŒå°ã‹ã‚Œã‚‹:
- **Fokker-Planckæ–¹ç¨‹å¼** = KL divergenceã®å‹¾é…æµ
- **Porous medium equation** = ã‚ã‚‹æ±é–¢æ•°ã®å‹¾é…æµ

ã“ã‚ŒãŒ **JKO scheme** (Jordan-Kinderlehrer-Otto) ã®åŸºç›¤ã§ã‚ã‚Šã€Diffusion Modelã®ç†è«–çš„èƒŒæ™¯ã®1ã¤ã  [^5]ã€‚

> **âš ï¸ Warning:** **ã“ã“ãŒæœ€å¤§ã®å³ **: Displacement convexityã¨Wassersteinå‹¾é…æµã¯ã€æ¸¬åº¦è«–ã¨å¤‰åˆ†æ³•ã®ä¸¡æ–¹ã®çŸ¥è­˜ãŒå¿…è¦ã€‚å®Œå…¨ç†è§£ã‚’ç›®æŒ‡ã•ãšã€ã€ŒWassersteinç©ºé–“ã§ã‚‚å‡¸æ€§ãŒå®šç¾©ã§ãã€å‹¾é…æµãŒå°ã‹ã‚Œã‚‹ã€ã¨ã„ã†ç›´æ„Ÿã‚’æ´ã‚ã°OKã€‚è©³ç´°ã¯ **ç¬¬36å› Flow Matchingçµ±ä¸€ç†è«–** ã§å†è¨ªã™ã‚‹ã€‚

> **Note:** **é€²æ—: 50% å®Œäº†** ãƒœã‚¹æˆ¦ã‚¯ãƒªã‚¢ï¼ Mongeå•é¡Œã‹ã‚‰Kantorovichç·©å’Œã€Wassersteinè·é›¢ã€åŒå¯¾æ€§ã€Sinkhornç®—æ³•ã€ãã—ã¦å¹¾ä½•å­¦çš„è¦–ç‚¹ã¾ã§ä¸€æ°—ã«é§†ã‘æŠœã‘ãŸã€‚ã“ã“ã‹ã‚‰å®Ÿè£…ã§ç†è«–ã‚’è¡€è‚‰åŒ–ã™ã‚‹ã€‚

### 3.7 Neural Optimal Transport â€” ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆã§æœ€é©è¼¸é€ã‚’å­¦ç¿’ã™ã‚‹

#### 3.7.1 Neural OTã®å‹•æ©Ÿ

ã“ã‚Œã¾ã§è¦‹ã¦ããŸæ‰‹æ³•ã¯ã€å…¨ã¦ **ã‚µãƒ³ãƒ—ãƒ«æ•° $n$ ã«ä¾å­˜ã™ã‚‹è¨ˆç®—é‡** ã‚’æŒã¤:
- ç·šå½¢è¨ˆç”»æ³•: $O(n^3 \log n)$
- Sinkhorn: $O(n^2 / \varepsilon)$

ã—ã‹ã—å®Ÿéš›ã®æ©Ÿæ¢°å­¦ç¿’ã§ã¯:
- ãƒ‡ãƒ¼ã‚¿æ•°ãŒæ•°ä¸‡ã€œæ•°ç™¾ä¸‡è¦æ¨¡ï¼ˆImageNetãªã©ï¼‰
- ãƒŸãƒ‹ãƒãƒƒãƒã”ã¨ã«OTã‚’è¨ˆç®—ã—ãŸã„ï¼ˆWGANè¨“ç·´ãªã©ï¼‰
- ã‚µãƒ³ãƒ—ãƒ«åŠ¹ç‡ãŒé‡è¦ï¼ˆå°‘æ•°ã‚µãƒ³ãƒ—ãƒ«ã§æ±åŒ–ï¼‰

**è§£æ±ºç­–**: ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§æœ€é©è¼¸é€å†™åƒ $T$ ã‚„ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ« $\phi$ ã‚’ **ãƒ‘ãƒ©ãƒ¡ãƒˆãƒªãƒƒã‚¯ã«è¿‘ä¼¼** ã™ã‚‹ [^10]ã€‚

#### 3.7.2 Input-Convex Neural Networks (ICNN)

Brenierå®šç†ï¼ˆÂ§3.4.2ï¼‰ã‚ˆã‚Šã€2-Wassersteinè·é›¢ã®æœ€é©è¼¸é€å†™åƒã¯å‡¸ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ« $\phi$ ã®å‹¾é… $T = \nabla \phi$ ã§è¡¨ã•ã‚Œã‚‹ã€‚

**ICNN** (Amos et al., 2017) [^8] ã¯ã€å‡ºåŠ›ãŒå…¥åŠ›ã«é–¢ã—ã¦ **å‡¸** ã«ãªã‚‹ã‚ˆã†è¨­è¨ˆã•ã‚ŒãŸãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆ:

$$
z^{(0)} = \boldsymbol{x}
$$

$$
z^{(i+1)} = \sigma\left( W_z^{(i)} z^{(i)} + W_x^{(i)} \boldsymbol{x} + \boldsymbol{b}^{(i)} \right)
$$

ã“ã“ã§:
- $W_z^{(i)} \geq 0$ ï¼ˆéè² åˆ¶ç´„ï¼‰
- $\sigma$ ã¯å‡¸ã§å˜èª¿å¢—åŠ ãªæ´»æ€§åŒ–é–¢æ•°ï¼ˆReLU, softplusï¼‰
- $W_x^{(i)}$ ã¯ä»»æ„ï¼ˆã‚¹ã‚­ãƒƒãƒ—æ¥ç¶šï¼‰

**å®šç†**: å„å±¤ã§ $W_z^{(i)} \geq 0$ ã‹ã¤ $\sigma$ ãŒå‡¸ãªã‚‰ã€$\phi(\boldsymbol{x})$ ã¯ $\boldsymbol{x}$ ã«é–¢ã—ã¦å‡¸ã€‚

**è¨“ç·´**: KantorovichåŒå¯¾å•é¡Œã‚’æœ€å¤§åŒ–:

$$
\max_{\phi \in \text{ICNN}} \left\{ \mathbb{E}_{\boldsymbol{x} \sim \mu}[\phi(\boldsymbol{x})] - \mathbb{E}_{\boldsymbol{y} \sim \nu}[\phi^*(\boldsymbol{y})] \right\}
$$

ã“ã“ã§ $\phi^*$ ã¯å‡¸å…±å½¹ï¼ˆæ•°å€¤çš„ã«è¨ˆç®—ã€ã¾ãŸã¯åˆ¥ã®ICNNã§è¿‘ä¼¼ï¼‰ã€‚

**Rustå®Ÿè£…ä¾‹**:


**èª²é¡Œ**:
- å‡¸å…±å½¹ $\phi^*$ ã®è¨ˆç®—ãŒé«˜ã‚³ã‚¹ãƒˆ
- ã‚µãƒ³ãƒ—ãƒ«æ•°ãŒå°‘ãªã„ã¨ä¸å®‰å®š
- é«˜æ¬¡å…ƒã§å‹¾é…ãŒæ¶ˆå¤±ã—ã‚„ã™ã„

#### 3.7.3 Wasserstein Wormhole: Transformerã§ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ãªOT

Uscidda & Cuturi (2024) [^11] ã¯ã€**Transformer Autoencoder** ã‚’ä½¿ã£ã¦OTè·é›¢ã‚’è¿‘ä¼¼ã™ã‚‹æ‰‹æ³•ã‚’ææ¡ˆã—ãŸã€‚

**ã‚¢ã‚¤ãƒ‡ã‚¢**:
1. çµŒé¨“åˆ†å¸ƒï¼ˆç‚¹é›†åˆï¼‰ã‚’Transformer Encoderã§ **å›ºå®šé•·ãƒ™ã‚¯ãƒˆãƒ«** ã«åŸ‹ã‚è¾¼ã‚€
2. æ½œåœ¨ç©ºé–“ã§ **ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰è·é›¢** ã‚’è¨ˆç®—
3. ã“ã®è·é›¢ãŒWassersteinè·é›¢ã‚’è¿‘ä¼¼ã™ã‚‹ã‚ˆã†è¨“ç·´

**å®šå¼åŒ–**:

$$
\text{Encoder}: \mu = \sum_{i=1}^n p_i \delta_{x_i} \mapsto \boldsymbol{z}_\mu \in \mathbb{R}^d
$$

$$
\text{Loss}: \left| \|\boldsymbol{z}_\mu - \boldsymbol{z}_\nu\|_2 - W_2(\mu, \nu) \right|^2
$$

**åˆ©ç‚¹**:
- ç‚¹æ•° $n$ ã«ä¾å­˜ã—ãªã„ï¼ˆTransformerã¯é›†åˆã‚’å›ºå®šé•·ã«åœ§ç¸®ï¼‰
- **Amortization**: ä¸€åº¦è¨“ç·´ã™ã‚Œã°ã€æ–°ã—ã„åˆ†å¸ƒãƒšã‚¢ã«å¯¾ã—ã¦é«˜é€Ÿæ¨è«–ï¼ˆ$O(nd)$ ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ + $O(d)$ ã®è·é›¢è¨ˆç®—ï¼‰
- Mini-batch OTã‚ˆã‚Šé«˜é€Ÿ

**å®Ÿè£…ã‚¹ã‚±ãƒƒãƒ**:


**å®Ÿé¨“çµæœ** (Uscidda & Cuturi, 2024 [^11]):
- ImageNetç”»åƒã®OTè·é›¢ã‚’ **50å€é«˜é€ŸåŒ–**ï¼ˆSinkhornã¨æ¯”è¼ƒï¼‰
- æ±åŒ–æ€§èƒ½: è¨“ç·´æ™‚ã«è¦‹ã¦ã„ãªã„åˆ†å¸ƒã«ã‚‚æ­£ç¢ºãªè·é›¢ã‚’äºˆæ¸¬

#### 3.7.4 Neural OTã®ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯å•é¡Œ

Korotin et al. (2021) [^12] ã¯ã€Neural OTã‚½ãƒ«ãƒãƒ¼ã®æ€§èƒ½ã‚’å®šé‡è©•ä¾¡ã™ã‚‹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’ææ¡ˆã—ãŸã€‚

**å•é¡Œè¨­å®š**:
- **é€£ç¶šåˆ†å¸ƒ**: $\mu = \mathcal{N}(0, I)$, $\nu = \mathcal{N}(m, \Sigma)$ ãªã©é–‰å½¢å¼è§£ãŒã‚ã‚‹åˆ†å¸ƒ
- **è©•ä¾¡æŒ‡æ¨™**:
  1. $W_2$ è·é›¢ã®æ¨å®šèª¤å·®
  2. è¼¸é€å†™åƒ $T$ ã® $L^2$ èª¤å·®: $\mathbb{E}_{\boldsymbol{x} \sim \mu}[\|T(\boldsymbol{x}) - T^*(\boldsymbol{x})\|^2]$
  3. Push-forwardèª¤å·®: $W_2(T_\sharp \mu, \nu)$

**ä¸»è¦ãªç™ºè¦‹**:
- **ICNNã¯é«˜æ¬¡å…ƒã§ä¸å®‰å®š**: æ¬¡å…ƒ $d > 50$ ã§å‹¾é…æ¶ˆå¤±
- **Monge Gapæ­£å‰‡åŒ–ãŒæœ‰åŠ¹**: $\mathbb{E}[\|\nabla T - I\|^2]$ ã‚’åŠ ãˆã‚‹ã¨å®‰å®šåŒ–
- **Mini-batch SinkhornãŒä¾ç„¶ã¨ã—ã¦æœ€å¼·**: ç²¾åº¦ã¨é€Ÿåº¦ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã§å„ªä½

**æ•°å€¤å®Ÿé¨“ï¼ˆã‚¬ã‚¦ã‚¹åˆ†å¸ƒã®ä¾‹ï¼‰**:


### 3.8 Sinkhornç®—æ³•ã®æœ€æ–°ç™ºå±• â€” é«˜é€ŸåŒ–ã¨ä¸€èˆ¬åŒ–

#### 3.8.1 Sparse Sinkhorn: ã‚¹ãƒ‘ãƒ¼ã‚¹æ€§ã‚’æ´»ç”¨ã—ãŸé«˜é€ŸåŒ–

**å•é¡Œ**: Sinkhornã®1åå¾©ã¯ $O(n^2)$ ã®è¡Œåˆ—-ãƒ™ã‚¯ãƒˆãƒ«ç©ãŒå¿…è¦ã€‚$n = 10^6$ ã§ã¯ç¾å®Ÿçš„ã§ãªã„ã€‚

**è§£æ±ºç­–** (Schmitzer, 2016): ã‚³ã‚¹ãƒˆè¡Œåˆ— $\boldsymbol{C}$ ã®å°ã•ã„è¦ç´ ã‚’ **åˆ‡ã‚Šæ¨ã¦** ã¦ã‚¹ãƒ‘ãƒ¼ã‚¹åŒ– [^13]ã€‚

$$
K_{ij}^{\text{sparse}} = \begin{cases}
e^{-C_{ij} / \varepsilon} & \text{if } C_{ij} < \tau \\
0 & \text{otherwise}
\end{cases}
$$

ã“ã“ã§ $\tau$ ã¯é–¾å€¤ï¼ˆä¾‹: $\tau = 5\varepsilon$ï¼‰ã€‚

**ç†è«–çš„ä¿è¨¼**: åˆ‡ã‚Šæ¨ã¦èª¤å·®ã¯ $O(e^{-\tau / \varepsilon})$ ã§controlã§ãã‚‹ã€‚

**è¨ˆç®—é‡**: ã‚¹ãƒ‘ãƒ¼ã‚¹è¡Œåˆ—ã®ç©ã¯ $O(n \cdot \text{nnz})$ï¼ˆnnz = éã‚¼ãƒ­è¦ç´ æ•°ï¼‰
- ã‚°ãƒªãƒƒãƒ‰ä¸Šã®ç‚¹ãªã‚‰ $\text{nnz} = O(n)$ â†’ ç·šå½¢æ™‚é–“ï¼

**Rustå®Ÿè£…**:


**å‡ºåŠ›ä¾‹**:


**ã‚¹ãƒ‘ãƒ¼ã‚¹åŒ–ã§5å€ä»¥ä¸Šã®é«˜é€ŸåŒ–ã€ç²¾åº¦ã¯ã»ã¼åŒç­‰ï¼**

#### 3.8.2 Low-Rank Sinkhorn: ä½ãƒ©ãƒ³ã‚¯åˆ†è§£ã«ã‚ˆã‚‹è¨ˆç®—å‰Šæ¸›

**ã‚¢ã‚¤ãƒ‡ã‚¢** (Scetbon et al., 2021) [^14]: Gibbs kernel $\boldsymbol{K}$ ã‚’ä½ãƒ©ãƒ³ã‚¯è¿‘ä¼¼:

$$
\boldsymbol{K} \approx \boldsymbol{U} \boldsymbol{V}^\top, \quad \boldsymbol{U} \in \mathbb{R}^{n \times r}, \; \boldsymbol{V} \in \mathbb{R}^{m \times r}
$$

**åˆ©ç‚¹**: è¡Œåˆ—-ãƒ™ã‚¯ãƒˆãƒ«ç©ãŒ $O((n+m)r)$ ã«å‰Šæ¸›ï¼ˆ$r \ll \min(n, m)$ï¼‰

**åˆ†è§£æ‰‹æ³•**:
- **NystrÃ¶mè¿‘ä¼¼**: ãƒ©ãƒ³ãƒ€ãƒ ã« $r$ å€‹ã®åˆ—ã‚’ã‚µãƒ³ãƒ—ãƒ«
- **Randomized SVD**: ãƒ©ãƒ³ãƒ€ãƒ å°„å½± + QRåˆ†è§£

**å®Ÿè£…**:


**çµæœ**: ãƒ©ãƒ³ã‚¯20ã§ **5å€ã®ãƒ¡ãƒ¢ãƒªå‰Šæ¸›** + **3å€ã®é«˜é€ŸåŒ–**ã€ç²¾åº¦ã¯98%ä»¥ä¸Šç¶­æŒã€‚

#### 3.8.3 f-Divergenceæ­£å‰‡åŒ–Sinkhorn

Sinkhornç®—æ³•ã®ã‚¨ãƒ³ãƒˆãƒ­ãƒ”ãƒ¼æ­£å‰‡åŒ–ã¯ **KL divergence** ãƒ™ãƒ¼ã‚¹:

$$
H(\gamma) = -\sum_{ij} \gamma_{ij} \log \frac{\gamma_{ij}}{p_i q_j}
$$

Xie et al. (2021) [^15] ã¯ã€ã“ã‚Œã‚’ä¸€èˆ¬ã® **$f$-divergence** ã«æ‹¡å¼µã—ãŸ:

$$
D_f(\gamma \| p \otimes q) = \sum_{ij} p_i q_j f\left( \frac{\gamma_{ij}}{p_i q_j} \right)
$$

ã“ã“ã§ $f$ ã¯å‡¸é–¢æ•°ï¼ˆä¾‹: $f(t) = t \log t$ ã§ KLã€$f(t) = (t-1)^2$ ã§ $\chi^2$ divergenceï¼‰ã€‚

**ä¸€èˆ¬åŒ–Sinkhorn**:


**å¿œç”¨**: $\chi^2$ divergenceã¯ **robust OT** ã«æœ‰ç”¨ï¼ˆå¤–ã‚Œå€¤ã«å¯¾ã—ã¦é ‘å¥ï¼‰ã€‚

### 3.9 Optimal Transportã®æœ€æ–°å¿œç”¨ â€” Flow Matchingã€Diffusionã€Graph

#### 3.9.1 Optimal Transport CFM (OT-CFM)

**Conditional Flow Matching** (Lipman et al., 2023) ã¯ã€2ã¤ã®åˆ†å¸ƒé–“ã®ãƒ•ãƒ­ãƒ¼ã‚’å­¦ç¿’ã™ã‚‹æ‰‹æ³•ã  [^16]ã€‚

**æ¨™æº–çš„ãªFlow Matching**:
- æ™‚åˆ» $t \in [0,1]$ ã§åˆ†å¸ƒã‚’è£œé–“: $p_t$
- é€Ÿåº¦å ´ $v_t(\boldsymbol{x})$ ã‚’å­¦ç¿’ã—ã€ODE $\frac{d\boldsymbol{x}}{dt} = v_t(\boldsymbol{x})$ ã‚’è§£ã„ã¦ $p_0 \to p_1$ ã‚’å®Ÿç¾

**OT-CFMã®æ”¹è‰¯**:
- é€šå¸¸ã®Flow Matchingã¯ **ç›´ç·šè£œé–“** ã‚’ä½¿ã†: $\boldsymbol{x}_t = (1-t)\boldsymbol{x}_0 + t \boldsymbol{x}_1$
- OT-CFMã¯ **æœ€é©è¼¸é€è¨ˆç”» $\gamma^*$** ã«åŸºã¥ã„ã¦ $(\boldsymbol{x}_0, \boldsymbol{x}_1)$ ã‚’ã‚µãƒ³ãƒ—ãƒ«

$$
(\boldsymbol{x}_0, \boldsymbol{x}_1) \sim \gamma^* \in \Pi(\mu, \nu)
$$

**ãªãœæœ‰åŠ¹ã‹ï¼Ÿ**:
- OTã¯ã€Œæœ€çŸ­çµŒè·¯ã€ã§åˆ†å¸ƒã‚’ç¹‹ããŸã‚ã€ãƒ•ãƒ­ãƒ¼ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã‚‹
- è¨“ç·´ã®åˆ†æ•£ãŒæ¸›ã‚‹ï¼ˆçµŒè·¯ãŒç›´ç·šçš„ï¼‰
- æ¨è«–ãŒé«˜é€ŸåŒ–ï¼ˆODE stepãŒå°‘ãªãã¦æ¸ˆã‚€ï¼‰

**å®Ÿé¨“çµæœ** (Tong et al., 2023) [^17]:
- CIFAR-10ç”»åƒç”Ÿæˆ: OT-CFMã¯ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚ˆã‚Š **FID 20%æ”¹å–„**
- ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°é€Ÿåº¦: åŒä¸€å“è³ªã§ **2å€é«˜é€Ÿ**ï¼ˆODE stepå‰Šæ¸›ï¼‰

#### 3.9.2 Diffusion Modelsã¨Optimal Transportã®æ¥ç¶š

Pooladian et al., 2023 [^18] ã¯ã€**Score-Based Diffusion Model** ãŒWassersteinå‹¾é…æµã¨ã—ã¦è§£é‡ˆã§ãã‚‹ã“ã¨ã‚’ç¤ºã—ãŸã€‚

**Forward SDE**:

$$
d\boldsymbol{x}_t = -\frac{1}{2} \nabla \log p_t(\boldsymbol{x}_t) \, dt + d\boldsymbol{w}_t
$$

ã“ã‚Œã¯ **KL divergence** $D_{\text{KL}}(p_t \| \pi)$ ã® **Wassersteinå‹¾é…æµ** ã«å¯¾å¿œï¼ˆ$\pi$ = æ¨™æº–ã‚¬ã‚¦ã‚¹ï¼‰ã€‚

**OTã¨ã®é–¢ä¿‚**:
- Diffusion processã¯ $p_0$ ã‹ã‚‰ $p_T$ ã¸ã®ã€Œæ›²ãŒã£ãŸçµŒè·¯ã€
- Optimal Transportã¯ã€Œç›´ç·šçµŒè·¯ã€ï¼ˆæ¸¬åœ°ç·šï¼‰
- Diffusionã¯OTã‚ˆã‚Š **å®‰å®š** ã ãŒã€**é…ã„**ï¼ˆå¤šæ•°ã®ã‚¹ãƒ†ãƒƒãƒ—å¿…è¦ï¼‰

**Rectified Flow** (Liu et al., 2022) [^19]:
- Diffusionã¨OTã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰
- åå¾©çš„ã«çµŒè·¯ã‚’ã€Œã¾ã£ã™ãã«ã™ã‚‹ã€ï¼ˆrectificationï¼‰
- æœ€çµ‚çš„ã«OTã«åæŸã—ã€1-stepã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãŒå¯èƒ½ã«

#### 3.9.3 Optimal Transport Graph Neural Networks

Zhang et al., 2020 [^20] ã¯ã€**ã‚°ãƒ©ãƒ•æ§‹é€ ã‚’OTã§æ¯”è¼ƒ** ã™ã‚‹æ‰‹æ³•ã‚’ææ¡ˆã—ãŸã€‚

**å•é¡Œè¨­å®š**: 2ã¤ã®ã‚°ãƒ©ãƒ• $G_1 = (V_1, E_1)$, $G_2 = (V_2, E_2)$ ã®é¡ä¼¼åº¦ã‚’æ¸¬ã‚ŠãŸã„ã€‚

**è§£æ±ºç­–**:
1. GNNã§å„ãƒãƒ¼ãƒ‰ã®åŸ‹ã‚è¾¼ã¿ $\{\boldsymbol{h}_i\}$ ã‚’è¨ˆç®—
2. 2ã¤ã®ã‚°ãƒ©ãƒ•ã®åŸ‹ã‚è¾¼ã¿é›†åˆ $\{\boldsymbol{h}_i^{(1)}\}$, $\{\boldsymbol{h}_j^{(2)}\}$ é–“ã®Wassersteinè·é›¢ã‚’è¨ˆç®—

$$
W_2(\mu_1, \mu_2), \quad \mu_k = \frac{1}{|V_k|} \sum_{i \in V_k} \delta_{\boldsymbol{h}_i^{(k)}}
$$

3. ã“ã®è·é›¢ã‚’æå¤±é–¢æ•°ã«çµ„ã¿è¾¼ã‚“ã§GNNã‚’è¨“ç·´

**å¿œç”¨**: åˆ†å­ã‚°ãƒ©ãƒ•ç”Ÿæˆ (Huang et al., 2024) [^21] â€” OTã§è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã¨ã®è·é›¢ã‚’æœ€å°åŒ–

**å®Ÿè£…ã‚¹ã‚±ãƒƒãƒ**:


### 3.10 å®Ÿè·µçš„ãªTips â€” OTã‚’ä½¿ã†éš›ã®è½ã¨ã—ç©´ã¨å¯¾ç­–

#### 3.10.1 ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ $\varepsilon$ ã®é¸ã³æ–¹

**å•é¡Œ**: $\varepsilon$ ãŒå°ã•ã™ãã‚‹ã¨æ•°å€¤ä¸å®‰å®šã€å¤§ãã™ãã‚‹ã¨ç²¾åº¦ä½ä¸‹ã€‚

**ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**:
1. **ãƒ‡ãƒ¼ã‚¿ã‚¹ã‚±ãƒ¼ãƒ«ã«åˆã‚ã›ã‚‹**: $\varepsilon \approx 0.01 \sim 0.1 \times \text{median}(C_{ij})$
2. **Warmstart**: $\varepsilon = 1.0$ ã‹ã‚‰å§‹ã‚ã€å¾ã€…ã«å°ã•ãã™ã‚‹ï¼ˆannealingï¼‰
3. **Log-domainå®‰å®šåŒ–**: $\varepsilon < 0.01$ ãªã‚‰å¿…é ˆ


#### 3.10.2 ä¸å‡è¡¡åˆ†å¸ƒã¸ã®å¯¾å¿œ (Unbalanced OT)

**å•é¡Œ**: é€šå¸¸ã®OTã¯ $\sum p_i = \sum q_j = 1$ ã‚’è¦æ±‚ï¼ˆè³ªé‡ä¿å­˜ï¼‰ã€‚ã—ã‹ã—å®Ÿãƒ‡ãƒ¼ã‚¿ã§ã¯:
- ãƒã‚¤ã‚ºã‚„å¤–ã‚Œå€¤ã§è³ªé‡ãŒä¸€è‡´ã—ãªã„
- éƒ¨åˆ†çš„ãªãƒãƒƒãƒãƒ³ã‚°ã®ã¿å¿…è¦ï¼ˆä¾‹: ç”»åƒã®ä¸€éƒ¨ã ã‘å¯¾å¿œï¼‰

**è§£æ±ºç­–** (Chizat et al., 2018): **Unbalanced OT** â€” å‘¨è¾ºåˆ¶ç´„ã‚’ç·©å’Œã—ã€ãƒšãƒŠãƒ«ãƒ†ã‚£é …ã‚’è¿½åŠ  [^22]:

$$
\min_{\gamma \geq 0} \sum_{ij} C_{ij} \gamma_{ij} + \varepsilon H(\gamma) + \tau_1 D_{\text{KL}}(\gamma \boldsymbol{1}_m \| p) + \tau_2 D_{\text{KL}}(\gamma^\top \boldsymbol{1}_n \| q)
$$

ã“ã“ã§ $\tau_1, \tau_2$ ã¯è³ªé‡ä¸å‡è¡¡ã®è¨±å®¹åº¦ã€‚

**å®Ÿè£…**:


#### 3.10.3 é«˜æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿ã§ã®æ¬¡å…ƒå‰Šæ¸›

**å•é¡Œ**: $d > 100$ ã§ã¯ã€è·é›¢ $\|\boldsymbol{x} - \boldsymbol{y}\|$ ãŒ concentration of measureåŠ¹æœã§æƒ…å ±ã‚’å¤±ã†ã€‚

**è§£æ±ºç­–**:
1. **Sliced Wasserstein Distance**: ãƒ©ãƒ³ãƒ€ãƒ ãª1æ¬¡å…ƒå°„å½±ã‚’å¹³å‡
   $$W_{\text{SW}}(\mu, \nu) = \int_{\mathbb{S}^{d-1}} W_1(\pi_\theta^\sharp \mu, \pi_\theta^\sharp \nu) \, d\theta$$
2. **PCAã§å‰å‡¦ç†**: ä¸»è¦ãª $k$ æ¬¡å…ƒã®ã¿ä½¿ç”¨
3. **Learned metrics**: ãƒ‹ãƒ¥ãƒ¼ãƒ©ãƒ«ãƒãƒƒãƒˆã§è·é›¢ã‚’å­¦ç¿’


> **Note:** **é€²æ—: 60% å®Œäº†** Neural OTã€Sinkhornæœ€æ–°æ‰‹æ³•ã€Flow Matchingãƒ»Diffusionãƒ»Graphã¸ã®å¿œç”¨ã¾ã§ã€2020-2025å¹´ã®æœ€æ–°ç ”ç©¶ã‚’ç¶²ç¾…ã—ãŸã€‚Part 2ã§å®Ÿè£…ã¨å®Ÿé¨“ã«é€²ã‚€ã€‚

### 3.11 Sliced Wassersteinè·é›¢ â€” é«˜æ¬¡å…ƒOTã®å®Ÿç”¨çš„è¿‘ä¼¼

#### 3.11.1 å®šç¾©ã¨å‹•æ©Ÿ

Wassersteinè·é›¢ã¯ãƒ‡ãƒ¼ã‚¿åˆ†å¸ƒã®å¹¾ä½•å­¦çš„æ€§è³ªã‚’å¿ å®Ÿã«åæ˜ ã™ã‚‹ãŒã€é«˜æ¬¡å…ƒã§ã¯è¨ˆç®—ã‚³ã‚¹ãƒˆãŒç¾å®Ÿçš„ã§ãªã„ã€‚$d = 1000$ ã®åŸ‹ã‚è¾¼ã¿ç©ºé–“ã§ $n = 10^4$ ã‚µãƒ³ãƒ—ãƒ«ã‚’æ‰±ã†ã¨ã€Sinkhornã§ã•ãˆ $O(n^2)$ ã®ãƒ¡ãƒ¢ãƒªãŒé™ç•Œã«ãªã‚‹ã€‚ã—ã‹ã‚‚ $W_p$ ã®ã‚µãƒ³ãƒ—ãƒ«æ¨å®šèª¤å·®ã¯ $O(n^{-2/d})$ â€” $d > 10$ ã§ã¯åæŸãŒå®Ÿç”¨çš„ã«ç„¡æ„å‘³ãªã»ã©é…ã„ã€‚

è§£æ±ºç­–ã®ä¸€ã¤ãŒ **Sliced Wassersteinè·é›¢ (SW)** ã ã€‚ã‚¢ã‚¤ãƒ‡ã‚¢ã¯å˜ç´”ã§ç¾ã—ã„: é«˜æ¬¡å…ƒåˆ†å¸ƒã‚’ç„¡æ•°ã® **1æ¬¡å…ƒå°„å½±** ã«åˆ†è§£ã—ã€1æ¬¡å…ƒã§ã¯é–‰å½¢å¼è§£ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã‚’åˆ©ç”¨ã™ã‚‹ã€‚

$\mathbb{S}^{d-1}$ ã‚’ $d$ æ¬¡å…ƒå˜ä½çƒé¢ã€$\pi^\theta: \mathbb{R}^d \to \mathbb{R}$ ã‚’æ–¹å‘ $\theta \in \mathbb{S}^{d-1}$ ã¸ã®1æ¬¡å…ƒå°„å½±:

$$
\pi^\theta(\boldsymbol{x}) := \langle \boldsymbol{x}, \theta \rangle
$$

$\pi^\theta_\sharp \mu$ ã¯ $\mu$ ã‚’æ–¹å‘ $\theta$ ã«å°„å½±ã—ãŸ1æ¬¡å…ƒåˆ†å¸ƒã€‚**$p$-Sliced Wassersteinè·é›¢**:

$$
\text{SW}_p(\mu, \nu) := \left( \int_{\mathbb{S}^{d-1}} W_p^p(\pi^\theta_\sharp \mu, \pi^\theta_\sharp \nu) \, d\sigma(\theta) \right)^{1/p}
$$

ã“ã“ã§ $\sigma$ ã¯ $\mathbb{S}^{d-1}$ ä¸Šã®ä¸€æ§˜æ¸¬åº¦ï¼ˆè¡¨é¢ç©ã§æ­£è¦åŒ–ï¼‰ã€‚

| è¨˜å· | èª­ã¿ | æ„å‘³ |
|:-----|:-----|:-----|
| $\pi^\theta_\sharp \mu$ | ãƒ‘ã‚¤ ã‚·ãƒ¼ã‚¿ ã‚·ãƒ£ãƒ¼ãƒ— ãƒŸãƒ¥ãƒ¼ | æ–¹å‘ $\theta$ ã¸ã®å°„å½±ã«ã‚ˆã‚‹ $\mu$ ã®push-forwardï¼ˆ1æ¬¡å…ƒåˆ†å¸ƒï¼‰ |
| $\mathbb{S}^{d-1}$ | $d-1$ æ¬¡å…ƒçƒé¢ | $\{\theta \in \mathbb{R}^d : \|\theta\| = 1\}$ |
| $d\sigma(\theta)$ | ãƒ‡ã‚£ãƒ¼ ã‚·ã‚°ãƒ ã‚·ãƒ¼ã‚¿ | $\mathbb{S}^{d-1}$ ä¸Šã®ä¸€æ§˜æ¸¬åº¦ |

#### 3.11.2 1æ¬¡å…ƒWassersteinè·é›¢ã®é–‰å½¢å¼å°å‡º

1æ¬¡å…ƒã® $W_p$ ã«ã¯ **åˆ†ä½é–¢æ•°**ï¼ˆé€†ç´¯ç©åˆ†å¸ƒé–¢æ•°ï¼‰ã‚’ä½¿ã£ãŸé–‰å½¢å¼ãŒã‚ã‚‹ã€‚ã“ã‚ŒãŒSWã®è¨ˆç®—åŠ¹ç‡ã®æ ¹æºã ã€‚

**å®šç†** (1D OT = å˜èª¿å†é…ç½®):

$\mu, \nu \in \mathcal{P}_p(\mathbb{R})$ ã®ç´¯ç©åˆ†å¸ƒé–¢æ•°ã‚’ $F_\mu, F_\nu$ã€åˆ†ä½é–¢æ•°ã‚’ $F_\mu^{-1}, F_\nu^{-1}: (0,1) \to \mathbb{R}$ ã¨ã™ã‚‹ã¨:

$$
W_p^p(\mu, \nu) = \int_0^1 \left| F_\mu^{-1}(t) - F_\nu^{-1}(t) \right|^p dt
$$

**è¨¼æ˜ã®ã‚¹ã‚±ãƒƒãƒ**:

1æ¬¡å…ƒã§ã¯ã€è¼¸é€è¨ˆç”» $\gamma \in \Pi(\mu, \nu)$ ã®ä¸­ã§æœ€é©ãªã‚‚ã®ã¯ **å˜èª¿å†é…ç½®** (monotone rearrangement):

$$
T^*(x) = F_\nu^{-1}(F_\mu(x))
$$

$T^*$ ãŒæœ€é©ãªç†ç”±ã¯ **rearrangement inequality**ï¼ˆLorentzä¸ç­‰å¼ï¼‰ã«ã‚ˆã‚‹:

$$
x_1 \leq x_2, \; y_1 \leq y_2 \implies |x_1 - y_2|^p + |x_2 - y_1|^p \geq |x_1 - y_1|^p + |x_2 - y_2|^p \quad (p \geq 1)
$$

ã€Œäº¤å·®ã™ã‚‹è¼¸é€çµŒè·¯ã¯å¸¸ã«ã‚³ã‚¹ãƒˆéåŠ¹ç‡ã€ã¨ã„ã†ç›´æ„Ÿã ã€‚1æ¬¡å…ƒã§ã®ã¿æˆç«‹ã™ã‚‹ã“ã®å˜èª¿æ€§ãŒã€Mongeå•é¡Œï¼ˆÂ§3.1ï¼‰ãŒ1æ¬¡å…ƒã§ trivialã«è§£ã‘ã¦é«˜æ¬¡å…ƒã§é›£ã—ã„ç†ç”±ã§ã‚‚ã‚ã‚‹ã€‚

å¤‰æ•°å¤‰æ› $t = F_\mu(x)$ï¼ˆå˜èª¿ã ã‹ã‚‰å¾®åˆ†å¯èƒ½ a.e.ã€$dx = dF_\mu^{-1}(t)/dt \cdot dt$ï¼‰ã§ç©åˆ†ã‚’ $[0,1]$ ä¸Šã«å¤‰æ›:

$$
\int_\mathbb{R} |x - T^*(x)|^p d\mu(x) = \int_0^1 |F_\mu^{-1}(t) - F_\nu^{-1}(t)|^p dt \quad \square
$$

> **Note:** é›¢æ•£ã®å ´åˆï¼ˆ$\mu = \frac{1}{n}\sum_i \delta_{x_i}$, $\nu = \frac{1}{n}\sum_j \delta_{y_j}$ï¼‰ã€åˆ†ä½é–¢æ•°ã®å·®ã¯ **ã‚½ãƒ¼ãƒˆå¾Œã®å·®** ã«å¯¾å¿œã™ã‚‹: $W_p^p = \frac{1}{n}\sum_k |x_{(k)} - y_{(k)}|^p$ï¼ˆ$x_{(k)}, y_{(k)}$ ã¯ã‚½ãƒ¼ãƒˆæ¸ˆã¿ç³»åˆ—ï¼‰ã€‚ã“ã‚ŒãŒ $O(n\log n)$ ã§è¨ˆç®—ã§ãã‚‹æ‰€ä»¥ã ã€‚

**ã‚¬ã‚¦ã‚¹åˆ†å¸ƒã®é–‰å½¢å¼**:

$\mu = \mathcal{N}(m_0, \sigma_0^2)$, $\nu = \mathcal{N}(m_1, \sigma_1^2)$ ã®ã¨ã $F_\mu^{-1}(t) = m_0 + \sigma_0 \Phi^{-1}(t)$ï¼ˆ$\Phi^{-1}$ = æ¨™æº–æ­£è¦åˆ†ä½é–¢æ•°ï¼‰ã€‚

$$
W_2^2 = \int_0^1 \left|(m_1 - m_0) + (\sigma_1 - \sigma_0)\Phi^{-1}(t)\right|^2 dt
$$

$$
= (m_1 - m_0)^2 + 2(m_1-m_0)(\sigma_1-\sigma_0)\underbrace{\int_0^1 \Phi^{-1}(t)dt}_{=0} + (\sigma_1-\sigma_0)^2\underbrace{\int_0^1 (\Phi^{-1}(t))^2 dt}_{=\mathbb{E}[Z^2]=1}
$$

$$
= (m_1 - m_0)^2 + (\sigma_1 - \sigma_0)^2
$$

Zone 0 ã® Rust ã‚³ãƒ¼ãƒ‰ã§ä½¿ã£ãŸå…¬å¼ãŒã€ã“ã“ã‹ã‚‰å³å¯†ã«å°å‡ºã•ã‚ŒãŸã€‚

#### 3.11.3 $\text{SW}_p$ ã¯è·é›¢ã§ã‚ã‚‹

**å®šç†**: $\text{SW}_p$ ã¯ $\mathcal{P}_p(\mathbb{R}^d)$ ä¸Šã®è·é›¢ã§ã‚ã‚‹ã€‚

éè² æ€§ãƒ»å¯¾ç§°æ€§ãƒ»ä¸‰è§’ä¸ç­‰å¼ã¯ $W_p$ ãŒè·é›¢ã§ã‚ã‚‹ã“ã¨ï¼ˆÂ§3.3.2ï¼‰ã‹ã‚‰å®¹æ˜“ã«å¾“ã†ã€‚éè‡ªæ˜ãªã®ã¯**åŒä¸€å¾‹**ã®ã¿ã ã€‚

$\text{SW}_p(\mu, \nu) = 0$ ã‚’ä»®å®šã™ã‚‹ã€‚ã™ã‚‹ã¨ $d\sigma$-a.e. ã® $\theta$ ã«å¯¾ã— $W_p(\pi^\theta_\sharp \mu, \pi^\theta_\sharp \nu) = 0$ã€ã™ãªã‚ã¡ $\pi^\theta_\sharp \mu = \pi^\theta_\sharp \nu$ï¼ˆå…¨æ–¹å‘ã®1æ¬¡å…ƒå°„å½±ãŒä¸€è‡´ï¼‰ã€‚

**CramÃ©r-Wold å®šç†**: ä»»æ„ã® $\theta \in \mathbb{S}^{d-1}$ ã§ $\pi^\theta_\sharp \mu = \pi^\theta_\sharp \nu$ ãªã‚‰ã° $\mu = \nu$ã€‚

è¨¼æ˜ã®éª¨æ ¼: ç¢ºç‡æ¸¬åº¦ã®ç‰¹æ€§é–¢æ•° $\hat{\mu}(\boldsymbol{t}) = \int e^{i\langle \boldsymbol{t}, \boldsymbol{x}\rangle} d\mu(\boldsymbol{x})$ ã«ãŠã„ã¦ã€$\boldsymbol{t} = r\theta$ ($r \in \mathbb{R}$, $\theta \in \mathbb{S}^{d-1}$) ã¨ãŠã‘ã° $\hat{\mu}(r\theta) = \widehat{\pi^\theta_\sharp \mu}(r)$ï¼ˆ$\pi^\theta_\sharp \mu$ ã®1æ¬¡å…ƒç‰¹æ€§é–¢æ•°ï¼‰ã€‚å…¨æ–¹å‘ã®å°„å½±ãŒä¸€è‡´ã™ã‚‹ã‹ã‚‰ $\hat{\mu}(\boldsymbol{t}) = \hat{\nu}(\boldsymbol{t})$ for all $\boldsymbol{t}$ã€ã‚ˆã£ã¦ $\mu = \nu$ã€‚$\square$

#### 3.11.4 è¨ˆç®—é‡ã¨ã‚µãƒ³ãƒ—ãƒ«è¤‡é›‘æ€§ã®æ¯”è¼ƒ

**ãƒ¢ãƒ³ãƒ†ã‚«ãƒ«ãƒ­è¿‘ä¼¼**: $L$ å€‹ã®ãƒ©ãƒ³ãƒ€ãƒ æ–¹å‘ $\{\theta_l\}_{l=1}^L \sim \text{Uniform}(\mathbb{S}^{d-1})$ ã‚’ä½¿ã†ã€‚

$$
\widehat{\text{SW}}_p^p(\mu, \nu) = \frac{1}{L} \sum_{l=1}^L W_p^p(\pi^{\theta_l}_\sharp \hat{\mu}_n, \pi^{\theta_l}_\sharp \hat{\nu}_n)
$$

ã“ã“ã§ $\hat{\mu}_n = \frac{1}{n}\sum_i \delta_{x_i}$, $\hat{\nu}_n = \frac{1}{n}\sum_j \delta_{y_j}$ ã¯çµŒé¨“åˆ†å¸ƒã€‚

**è¨ˆç®—é‡**ï¼ˆ$n = m$ ã®å ´åˆï¼‰:
- å°„å½±: $O(Lnd)$ï¼ˆå†…ç© $\langle x_i, \theta_l \rangle$ ã®è¨ˆç®—ï¼‰
- ã‚½ãƒ¼ãƒˆï¼‹å·®åˆ†: $O(Ln\log n)$ï¼ˆå„æ–¹å‘ã§ã‚½ãƒ¼ãƒˆï¼‰
- åˆè¨ˆ: $O(Ln(d + \log n))$

å¯¾ã—ã¦Sinkhornã¯ $O(n^2/\varepsilon)$ï¼ˆå¯†è¡Œåˆ—æ¼”ç®—ï¼‰ã€‚$n = 10^4$, $d = 128$, $L = 200$ ã§æ¯”è¼ƒã™ã‚‹ã¨:
- Sinkhorn: $O(10^8)$ æ¼”ç®—ã€ãƒ¡ãƒ¢ãƒª $n^2 \times 4\text{ bytes} = 400\text{ MB}$ï¼ˆå®Ÿç”¨é™ç•Œï¼‰
- SW: $O(3 \times 10^8)$ æ¼”ç®—ã ãŒãƒ™ã‚¯ãƒˆãƒ«æ¼”ç®—ã§é«˜é€Ÿã€ãƒ¡ãƒ¢ãƒª $O(Lnd) \ll n^2$

**ã‚µãƒ³ãƒ—ãƒ«è¤‡é›‘æ€§**: åˆ†å¸ƒ $\mu, \nu$ ã‚’ $n$ ã‚µãƒ³ãƒ—ãƒ«ã§æ¨å®šã—ãŸã¨ãã®åæŸé€Ÿåº¦:

$$
\mathbb{E}[|\text{SW}_p(\hat{\mu}_n, \hat{\nu}_n) - \text{SW}_p(\mu, \nu)|] = O(n^{-1/2})
$$

ã“ã‚Œã¯æ¬¡å…ƒ $d$ ã«**ä¾å­˜ã—ãªã„**ã€‚å¯¾ã—ã¦ $W_p$ ã®åæŸé€Ÿåº¦ã¯ $O(n^{-2/d})$ â€” $d = 100$ ã§ã¯ $n > 10^{100}$ ã‚µãƒ³ãƒ—ãƒ«ãŒå¿…è¦ã«ãªã‚‹è¨ˆç®—ã«ãªã‚‹ã€‚ã‚µãƒ³ãƒ—ãƒ«åŠ¹ç‡ã®è¦³ç‚¹ã§ SW ã¯åœ§å€’çš„ã«æœ‰åˆ©ã ã€‚

> **âš ï¸ Warning:** $\text{SW}_p(\mu, \nu) \leq C_{d,p} \cdot W_p(\mu, \nu)$ ã¨ã„ã†ä¸Šç•ŒãŒæˆç«‹ã™ã‚‹ï¼ˆå°„å½±ã®éè†¨å¼µæ€§ã«ã‚ˆã‚‹ï¼‰ãŒã€é€†ã®ä¸ç­‰å¼ã¯æˆç«‹ã—ãªã„ã€‚SW ãŒå°ã•ãã¦ã‚‚ $W_p$ ã¯å¤§ãã„å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚ç”Ÿæˆãƒ¢ãƒ‡ãƒ«ã®æå¤±é–¢æ•°ã¨ã—ã¦ä½¿ã†å ´åˆã€SW ãŒã‚¼ãƒ­ã«åæŸã—ã¦ã‚‚å…ƒã® $W_p$ ãŒååˆ†å°ã•ã„ä¿è¨¼ã¯ãªãã€ç”Ÿæˆåˆ†å¸ƒã®ã€Œå°„å½±ä¸Šã§ã®ä¸€è‡´ã€ã—ã‹æ‹…ä¿ã•ã‚Œãªã„ã€‚

#### 3.11.5 Max-Sliced Wasserstein ã¨å®Ÿç”¨æ¯”è¼ƒ

å…¨æ–¹å‘ã‚’å¹³å‡ã™ã‚‹ä»£ã‚ã‚Šã«æœ€å¤§å€¤ã‚’å–ã‚‹å¤‰ç¨®ãŒã‚ã‚‹:

$$
\text{Max-SW}_p(\mu, \nu) := \max_{\theta \in \mathbb{S}^{d-1}} W_p(\pi^\theta_\sharp \mu, \pi^\theta_\sharp \nu)
$$

ã€Œæœ€ã‚‚å·®ãŒå¤§ãã„æ–¹å‘ã€ã‚’è¦‹ã¤ã‘ã‚‹å•é¡Œã¯å‹¾é…ä¸Šæ˜‡æ³•ã§è§£ã‘ã‚‹ã€‚$\text{Max-SW}_p \geq \text{SW}_p$ ã§ã‚ã‚Šè­˜åˆ¥åŠ›ãŒé«˜ã„ä¸€æ–¹ã€æœ€é© $\theta^*$ ã®æ¢ç´¢ã« $O(L_{\text{iter}} \times n \log n)$ï¼ˆ$L_{\text{iter}}$ = å‹¾é…ã‚¹ãƒ†ãƒƒãƒ—æ•°ï¼‰ã‹ã‹ã‚‹ã€‚

**ä¸»è¦æ‰‹æ³•ã®æ¯”è¼ƒè¡¨**:

| æ‰‹æ³• | è¨ˆç®—é‡ | ã‚µãƒ³ãƒ—ãƒ«åŠ¹ç‡ | å¹¾ä½•å­¦çš„æƒ…å ± | ä¸»ãªç”¨é€” |
|:-----|:-------|:------------|:------------|:---------|
| $W_2$ (Sinkhorn) | $O(n^2/\varepsilon)$ | $O(n^{-2/d})$ | å®Œå…¨ä¿å­˜ | å°è¦æ¨¡ç²¾å¯†æ¯”è¼ƒ ($n \leq 5000$) |
| $\text{SW}_2$ | $O(Ln\log n)$ | $O(n^{-1/2})$ | æ–¹å‘å¹³å‡ | ç”Ÿæˆãƒ¢ãƒ‡ãƒ«è¨“ç·´ (SWD-GAN, SWAE) |
| $\text{Max-SW}_2$ | $O(L_{\text{iter}} n\log n)$ | $O(n^{-1/2})$ | æœ€åŠ£æ–¹å‘ | é«˜è­˜åˆ¥åŠ›æ¯”è¼ƒ |
| FID ($W_2$ ã®ã‚¬ã‚¦ã‚¹è¿‘ä¼¼) | $O(nd^2)$ | é«˜ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒˆãƒªãƒƒã‚¯ï¼‰ | ã‚¬ã‚¦ã‚¹è¿‘ä¼¼ã®ã¿ | ç”»åƒç”Ÿæˆå“è³ªè©•ä¾¡ |
| KID (ã‚«ãƒ¼ãƒãƒ«MMD) | $O(n^2)$ | $O(n^{-1/2})$ | ã‚«ãƒ¼ãƒãƒ«ä¾å­˜ | FIDã‚ˆã‚Šä¸å |

Sliced Wasserstein Autoencoder (Kolouri et al., 2018) ã¯VAEã®KLé …ã‚’ $\text{SW}_2$ ã§ç½®æ›ã—ã€ãƒ¢ãƒ¼ãƒ‰å´©å£Šã‚’è»½æ¸›ã™ã‚‹ã€‚ç‚¹ç¾¤æ¯”è¼ƒï¼ˆ3Då½¢çŠ¶è§£æã€ShapeNetãªã©ï¼‰ã§ã‚‚ $\text{SW}_2$ ãŒæ¨™æº–æŒ‡æ¨™ã¨ã—ã¦ä½¿ã‚ã‚Œã¦ã„ã‚‹ã€‚

<details><summary>å°å‡º: 1æ¬¡å…ƒWâ‚‚ã®ã‚¬ã‚¦ã‚¹åˆ†å¸ƒé–‰å½¢å¼ã‚’0ã‹ã‚‰è¿½ã†</summary>

$\mu = \mathcal{N}(m_0, \sigma_0^2)$, $\nu = \mathcal{N}(m_1, \sigma_1^2)$ ã® 1D-$W_2^2$ ã‚’åˆ†ä½é–¢æ•°ã‹ã‚‰æ‰‹è¨ˆç®—ã™ã‚‹ã€‚

**Step 1 â€” åˆ†ä½é–¢æ•°ã‚’æ›¸ãä¸‹ã™**:

$$F_\mu^{-1}(t) = m_0 + \sigma_0 \Phi^{-1}(t), \quad F_\nu^{-1}(t) = m_1 + \sigma_1 \Phi^{-1}(t)$$

ã“ã“ã§ $\Phi^{-1}$ ã¯æ¨™æº–æ­£è¦åˆ†å¸ƒã®åˆ†ä½é–¢æ•°ï¼ˆprobit é–¢æ•°ï¼‰ã€‚

**Step 2 â€” å·®ã‚’è¨ˆç®—ã™ã‚‹**:

$$F_\mu^{-1}(t) - F_\nu^{-1}(t) = (m_0 - m_1) + (\sigma_0 - \sigma_1)\Phi^{-1}(t)$$

**Step 3 â€” äºŒä¹—ã—ã¦ç©åˆ†**:

$$W_2^2 = \int_0^1 \left[(m_0 - m_1) + (\sigma_0 - \sigma_1)\Phi^{-1}(t)\right]^2 dt$$

å±•é–‹ã™ã‚‹:

$$= (m_0 - m_1)^2 \int_0^1 dt + 2(m_0-m_1)(\sigma_0-\sigma_1)\int_0^1 \Phi^{-1}(t) dt + (\sigma_0 - \sigma_1)^2 \int_0^1 [\Phi^{-1}(t)]^2 dt$$

**Step 4 â€” å„ç©åˆ†ã‚’è©•ä¾¡**:

- $\int_0^1 dt = 1$ï¼ˆè‡ªæ˜ï¼‰
- $\int_0^1 \Phi^{-1}(t) dt = \mathbb{E}[Z] = 0$ï¼ˆ$Z \sim \mathcal{N}(0,1)$ ã®å¹³å‡ï¼‰
- $\int_0^1 [\Phi^{-1}(t)]^2 dt = \mathbb{E}[Z^2] = \text{Var}(Z) + (\mathbb{E}[Z])^2 = 1 + 0 = 1$

**Step 5 â€” ä»£å…¥**:

$$W_2^2(\mathcal{N}(m_0,\sigma_0^2), \mathcal{N}(m_1,\sigma_1^2)) = (m_0-m_1)^2 + (\sigma_0-\sigma_1)^2$$

å¤šæ¬¡å…ƒã‚¬ã‚¦ã‚¹ $\mathcal{N}(\boldsymbol{m}_0, \Sigma_0)$ ã¸ã®æ‹¡å¼µã¯ Â§1.1 ã® Bures è¨ˆé‡ã®å¼ã«ãªã‚‹ã€‚1æ¬¡å…ƒã¨é•ã„å„æ–¹å‘ã§åˆ†æ•£ã‚¹ã‚±ãƒ¼ãƒ«ãŒç•°ãªã‚‹ãŸã‚ã€è¡Œåˆ—ã®å¹³æ–¹æ ¹ $(\Sigma_1^{1/2}\Sigma_0\Sigma_1^{1/2})^{1/2}$ ãŒå¿…è¦ã«ãªã‚‹ã€‚

</details>

### 3.12 ç¢ºç‡ãƒ•ãƒ­ãƒ¼ODEã¨Wassersteinå‹¾é…æµã®å®Œå…¨æ¥ç¶š

#### 3.12.1 ç¢ºç‡ãƒ•ãƒ­ãƒ¼ODEã¨SDEã®ç­‰ä¾¡æ€§

Score-based Diffusion Modelï¼ˆÂ§3.9.2å‚ç…§ï¼‰ã®èƒŒå¾Œã«ã¯ã€SDEã¨ODEã®é©šãã¹ãç­‰ä¾¡æ€§ãŒã‚ã‚‹ã€‚

Forward SDEï¼ˆOUéç¨‹ï¼‰:

$$
d\boldsymbol{x}_t = -\frac{1}{2}\boldsymbol{x}_t \, dt + d\boldsymbol{w}_t
$$

ï¼ˆ$\boldsymbol{w}_t$ ã¯æ¨™æº–ãƒ–ãƒ©ã‚¦ãƒ³é‹å‹•ã€æ™‚åˆ» $T \to \infty$ ã§ $p_T \approx \mathcal{N}(0, I)$ï¼‰

ã“ã‚Œã¨ **åŒä¸€ã®å‘¨è¾ºåˆ†å¸ƒ** $\{p_t\}_{t \geq 0}$ ã‚’ç”Ÿæˆã™ã‚‹ç¢ºç‡ãƒ•ãƒ­ãƒ¼ODEï¼ˆSong et al., 2021 [^5]ï¼‰:

$$
\frac{d\boldsymbol{x}}{dt} = -\frac{1}{2}\boldsymbol{x} - \frac{1}{2}\nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x})
$$

ä¸€èˆ¬ã® SDE $d\boldsymbol{x} = \boldsymbol{f}(\boldsymbol{x}, t) dt + g(t) d\boldsymbol{w}$ ã«å¯¾ã—ã€ç­‰ä¾¡ãªç¢ºç‡ãƒ•ãƒ­ãƒ¼ODEã¯:

$$
\frac{d\boldsymbol{x}}{dt} = \boldsymbol{f}(\boldsymbol{x}, t) - \frac{1}{2} g(t)^2 \nabla_{\boldsymbol{x}} \log p_t(\boldsymbol{x})
$$

**ãªãœç­‰ä¾¡ã‹ï¼Ÿ** ä¸¡è€…ãŒåŒä¸€ã® Fokker-Planck æ–¹ç¨‹å¼ã‚’æº€ãŸã™ã‹ã‚‰ã :

$$
\partial_t p_t = -\nabla \cdot (p_t \boldsymbol{f}) + \frac{g(t)^2}{2} \Delta p_t
$$

ODEå´ã¯ã“ã‚Œã‚’é€£ç¶šã®æ–¹ç¨‹å¼ $\partial_t p_t + \nabla \cdot (p_t v_t) = 0$ ã¨ã—ã¦è§£é‡ˆã—ã€é€Ÿåº¦å ´ $v_t = \boldsymbol{f} - \frac{g^2}{2}\nabla \log p_t$ ã‚’å®šã‚ã‚‹ã€‚SDEã¯ãƒ©ãƒ³ãƒ€ãƒ çµŒè·¯ã‚’ç”Ÿæˆã™ã‚‹ãŒã€ODE ã¯æ±ºå®šè«–çš„çµŒè·¯ã‚’ç”Ÿæˆã—ãªãŒã‚‰ **åˆ†å¸ƒã¨ã—ã¦ã¯åŒã˜** $p_t$ ã‚’å®Ÿç¾ã™ã‚‹ã€‚

#### 3.12.2 Benamou-Brenierå…¬å¼ã¨é€£ç¶šã®æ–¹ç¨‹å¼

é€£ç¶šã®æ–¹ç¨‹å¼ã¯ OT ã®å¹¾ä½•å­¦ã¨æ·±ãçµã³ã¤ã„ã¦ã„ã‚‹ã€‚Benamou-Brenier (2000) ã®å…¬å¼:

$$
W_2^2(\mu_0, \mu_1) = \inf_{\{(\mu_t, v_t)\}} \int_0^1 \int_{\mathbb{R}^d} \|v_t(\boldsymbol{x})\|^2 d\mu_t(\boldsymbol{x}) \, dt
$$

åˆ¶ç´„: $\partial_t \mu_t + \nabla \cdot (\mu_t v_t) = 0$, $\mu|_{t=0} = \mu_0$, $\mu|_{t=1} = \mu_1$ã€‚

ã“ã‚Œã¯ $W_2^2(\mu_0, \mu_1)$ ã‚’ã€Œ2åˆ†å¸ƒé–“ã‚’é€£ç¶šã®æ–¹ç¨‹å¼ã«æ²¿ã£ã¦ç¹‹ãæœ€å°ã‚¨ãƒãƒ«ã‚®ãƒ¼çµŒè·¯å•é¡Œã€ã¨ã—ã¦è¡¨ç¾ã—ã¦ã„ã‚‹ã€‚æ¸¬åº¦ $\mu_t$ ã®ã€Œé€Ÿã•ã€ã¯ $L^2(\mu_t)$ ãƒãƒ«ãƒ  $\int \|v_t\|^2 d\mu_t$ ã§æ¸¬ã‚‰ã‚Œã€ãã®æ™‚é–“ç©åˆ†ãŒè¼¸é€ã‚³ã‚¹ãƒˆã«ãªã‚‹ã€‚

ã“ã®å…¬å¼ãŒæ•™ãˆã‚‹ã“ã¨: **Flow Matching ã§å­¦ç¿’ã™ã‚‹é€Ÿåº¦å ´ $v_\theta$ ã®ç†æƒ³å½¢ã¯ Benamou-Brenier ã®æœ€é©é€Ÿåº¦å ´**ã§ã‚ã‚Šã€ãã‚ŒãŒã¾ã•ã« OT é€Ÿåº¦å ´ $v_t^*(\boldsymbol{x}) = (T^*(\boldsymbol{x}) - \boldsymbol{x}) / (1 - t)$ï¼ˆç›´ç·šçµŒè·¯ã®é€Ÿåº¦ï¼‰ã«å¯¾å¿œã™ã‚‹ã€‚

#### 3.12.3 JKO scheme â€” Wassersteinå‹¾é…æµã®é›¢æ•£åŒ–

æ±é–¢æ•° $F: \mathcal{P}_2(\mathbb{R}^d) \to \mathbb{R}$ ã® **Wassersteinå‹¾é…æµ** ã¯ã€Œ$W_2$ è·é›¢ã‚’ä½¿ã£ã¦ $F$ ã‚’å‹¾é…é™ä¸‹ã™ã‚‹ç¢ºç‡æ¸¬åº¦ã®æ™‚é–“ç™ºå±•ã€ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹:

$$
\partial_t \mu_t = -\text{grad}_{W_2} F(\mu_t)
$$

Jordan-Kinderlehrer-Otto (JKO, 1998) ã¯ã“ã‚Œã‚’é›¢æ•£æ™‚é–“è¿‘ä¼¼ã§å³å¯†ã«å®šç¾©ã—ãŸ:

$$
\mu_{k+1} = \arg\min_{\mu \in \mathcal{P}_2} \left\{ \frac{W_2^2(\mu_k, \mu)}{2\tau} + F(\mu) \right\}
$$

| è¨˜å· | æ„å‘³ |
|:-----|:-----|
| $\tau$ | æ™‚é–“åˆ»ã¿å¹… ($\tau \to 0$ ã®æ¥µé™ã§é€£ç¶šå‹¾é…æµã«åæŸ) |
| $W_2^2(\mu_k, \mu) / (2\tau)$ | è¿‘æ¥é …: å‰ã‚¹ãƒ†ãƒƒãƒ—ã‹ã‚‰ã®ã€Œæ¸¬åº¦ã®ç§»å‹•é‡ã€ãƒšãƒŠãƒ«ãƒ†ã‚£ |
| $F(\mu)$ | æœ€å°åŒ–ã—ãŸã„æ±é–¢æ•° |

ã“ã‚Œã¯ãƒ¦ãƒ¼ã‚¯ãƒªãƒƒãƒ‰ç©ºé–“ã§ã® **è¿‘æ¥ç‚¹æ³•** $x_{k+1} = \arg\min_x \{\frac{\|x_k - x\|^2}{2\tau} + f(x)\}$ ã¨å…¨ãåŒã˜æ§‹é€ ã  â€” ãŸã ã—æ¸¬åº¦ç©ºé–“ $\mathcal{P}_2$ ä¸Šã§è¡Œã‚ã‚Œã‚‹ã€‚

**KL divergenceã®å ´åˆ**: $F(\mu) = D_{\text{KL}}(\mu \| \pi)$ ã¨ã™ã‚‹ã¨ã€JKO schemeã¯ $\tau \to 0$ ã§ **Fokker-Planckæ–¹ç¨‹å¼**ã«åæŸã™ã‚‹:

$$
\partial_t p = \nabla \cdot \left( p \nabla \log \frac{p}{\pi} \right)
$$

ã“ã‚Œã‚’å±•é–‹ã™ã‚‹ã¨ $\partial_t p = \Delta p - \nabla \cdot (p \nabla \log \pi)$ã€‚å®šå¸¸åˆ†å¸ƒã¯ $p = \pi$ï¼ˆ$\partial_t p = 0$ ã®ã¨ãï¼‰ã€‚

ã¤ã¾ã‚Š: **Langevin dynamics ã¯ KL divergence ã® Wasserstein å‹¾é…æµã **ã€‚MCMC ã®åæŸç†è«–ãŒ $W_2$ è·é›¢ã‚’ä½¿ã£ã¦æ›¸ã‘ã‚‹ã®ã¯ã“ã®ãŸã‚ã ã€‚

| æ±é–¢æ•° $F(\mu)$ | Wassersteinå‹¾é…æµã®å®šå¸¸åˆ†å¸ƒ | å¯¾å¿œã™ã‚‹åå¾®åˆ†æ–¹ç¨‹å¼ |
|:----------------|:---------------------------|:--------------------|
| $D_{\text{KL}}(\mu \| \pi)$ | $\pi$ï¼ˆç›®æ¨™åˆ†å¸ƒï¼‰ | Fokker-Planckæ–¹ç¨‹å¼ |
| $\int \nabla V \cdot d\mu$ï¼ˆãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ï¼‰ | $\delta_{\arg\min V}$ï¼ˆæœ€å°ç‚¹ï¼‰ | é€£ç¶šã®æ–¹ç¨‹å¼ |
| $\frac{1}{m-1}\int \mu^m d\mu$ï¼ˆRÃ©nyiï¼‰ | $\propto e^{-V}$ | Porous mediumæ–¹ç¨‹å¼ |
| $\frac{1}{2}W_2^2(\mu, \nu)$ï¼ˆè¼¸é€ï¼‰ | $\nu$ | McCannè£œé–“ï¼ˆÂ§3.6.1ï¼‰ |

> **âš ï¸ Warning:** JKO scheme ã®å„ã‚¹ãƒ†ãƒƒãƒ—ã¯ã€Œ$W_2$ è·é›¢ä»˜ãã®å¤‰åˆ†å•é¡Œã€ã§ã‚ã‚Šã€ãã‚Œè‡ªä½“ãŒæœ€é©è¼¸é€å•é¡Œã ã€‚è¨ˆç®—ã‚³ã‚¹ãƒˆãŒé«˜ãã€å®Ÿç”¨çš„ãªå®Ÿè£…ã«ã¯ Sinkhorn ã‚’ç”¨ã„ãŸè¿‘ä¼¼ (de Bortoli et al., 2021) ã‚„ç²’å­æ³•ãŒå¿…è¦ã«ãªã‚‹ã€‚Diffusion Model ã®ç†è«–çš„èƒŒæ™¯ã¨ã—ã¦ã® JKO ã¯ã€Œç›´æ„Ÿã®æ çµ„ã¿ã€ã¨ã—ã¦ç†è§£ã—ã€å®Ÿè£…è©³ç´°ã¯ç¬¬36å›ã¾ã§ä¿ç•™ã—ã¦ã‚ˆã„ã€‚

#### 3.12.4 Rectified Flow â€” åå¾©ã«ã‚ˆã‚‹OTã¸ã®åæŸ

Liu et al. (2022) [^4] ã® **Rectified Flow** ã¯æ¬¡ã®ç›®çš„é–¢æ•°ã§é€Ÿåº¦å ´ $v_\theta$ ã‚’è¨“ç·´ã™ã‚‹:

$$
\min_{v_\theta} \mathbb{E}_{t \sim U[0,1], \, (\boldsymbol{x}_0, \boldsymbol{x}_1) \sim \pi_0} \left[ \| v_\theta(\boldsymbol{x}_t, t) - (\boldsymbol{x}_1 - \boldsymbol{x}_0) \|^2 \right]
$$

ã“ã“ã§ $\boldsymbol{x}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_1$ï¼ˆç›´ç·šè£œé–“ï¼‰ã€$\pi_0 = \mu \otimes \nu$ï¼ˆç‹¬ç«‹çµåˆï¼‰ã€‚

**ãªãœç›´ç·šã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‹ï¼Ÿ** 2ç‚¹ $(\boldsymbol{x}_0, \boldsymbol{x}_1)$ ã‚’å›ºå®šã—ãŸã¨ãã€çµŒè·¯ $\boldsymbol{x}_t$ ã®é•·ã• $\int_0^1 \|\dot{\boldsymbol{x}}_t\| dt \geq \|\boldsymbol{x}_1 - \boldsymbol{x}_0\|$ï¼ˆç­‰å·ã¯ç›´ç·šã®ã¨ãï¼‰ã€‚ã—ãŸãŒã£ã¦ç›´ç·šè£œé–“ã¯ **æœŸå¾…çµŒè·¯é•·ã‚’æœ€å°åŒ–** ã™ã‚‹ã€‚ã‚¿ãƒ¼ã‚²ãƒƒãƒˆé€Ÿåº¦ $\boldsymbol{x}_1 - \boldsymbol{x}_0$ ã‚’å­¦ç¿’ã™ã‚‹ã“ã¨ã¯ã€Œã™ã¹ã¦ã®çµŒè·¯ã‚’ç›´ç·šã«ã™ã‚‹ã€ã“ã¨ã«ç­‰ã—ã„ã€‚

ãŸã ã—ç‹¬ç«‹çµåˆ $\pi_0 = \mu \otimes \nu$ ã§ã¯ã€ç•°ãªã‚‹ã‚«ãƒƒãƒ—ãƒªãƒ³ã‚°é–“ã§çµŒè·¯ãŒã€Œäº¤å·®ã€ã—å¾—ã‚‹ãŸã‚ã€é€Ÿåº¦å ´ãŒè¤‡é›‘ã«ãªã‚‹ã€‚

**Reflow â€” äº¤å·®çµŒè·¯ã®åå¾©çš„é™¤å»**:

1. Rectified Flow ã§ $v_\theta^{(1)}$ ã‚’è¨“ç·´ï¼ˆ$\pi_0 = \mu \otimes \nu$ï¼‰
2. ODE $\dot{\boldsymbol{x}} = v_\theta^{(1)}(\boldsymbol{x}, t)$ ã‚’è§£ã„ã¦æ–°çµåˆ $\pi_1 = (X_0, X_1^{\text{ODE}})_\sharp \mu$ ã‚’ç”Ÿæˆ
3. $\pi_1$ ã§æ–°ã—ã„ Rectified Flow $v_\theta^{(2)}$ ã‚’è¨“ç·´
4. ç¹°ã‚Šè¿”ã™: $\pi_0 \to \pi_1 \to \cdots \to \pi_k$

**å®šç†** (Liu et al., 2022): Reflow ã®å„åå¾©ã§ã‚«ãƒƒãƒ—ãƒªãƒ³ã‚°ã¯æ”¹å–„ã—ã€è¼¸é€ã‚³ã‚¹ãƒˆ $\mathbb{E}_{(\boldsymbol{x}_0, \boldsymbol{x}_1) \sim \pi_k}[\|\boldsymbol{x}_1 - \boldsymbol{x}_0\|^2]$ ã¯å˜èª¿éå¢—åŠ ã€‚ç„¡é™å›ã® Reflow ã®æ¥µé™ã§ã¯ $\pi_k \to \gamma^*$ï¼ˆ$W_2$-æœ€é©è¼¸é€è¨ˆç”»ï¼‰ã«åæŸã—ã€é€Ÿåº¦å ´ãŒ:

$$
v^*(\boldsymbol{x}, t) = T^*(\boldsymbol{x}) - \boldsymbol{x}
$$

ï¼ˆå®šæ•°é€Ÿåº¦å ´ã€ã™ãªã‚ã¡çµŒè·¯ãŒå®Œå…¨ã«ç›´ç·šï¼‰ã«åæŸã™ã‚‹ã€‚

$$
\underbrace{\mu \otimes \nu}_{\text{äº¤å·®å¤šæ•°}} \xrightarrow{\text{Reflow Ã—1}} \pi_1 \xrightarrow{\text{Reflow Ã—2}} \cdots \xrightarrow{\text{Reflow }\times\infty} \underbrace{\gamma^*}_{\text{OTè¨ˆç”»ã€äº¤å·®ã‚¼ãƒ­}}
$$

ç›´æ„Ÿ: æœ€åˆã¯ç‚¹ãŒå…¥ã‚Šä¹±ã‚Œã¦ã€Œäº¤å·®ã™ã‚‹è¼¸é€çµŒè·¯ã€ãŒå¤šæ•°ã‚ã‚‹ã€‚Reflow ãŒäº¤å·®ã‚’è§£æ¶ˆã™ã‚‹ãŸã³ã«çµŒè·¯ãŒã¾ã£ã™ãã«ãªã‚Šã€æœ€çµ‚çš„ã« OT map $T^*$ ã«ç›¸å½“ã™ã‚‹ straight flow ã«åæŸã™ã‚‹ã€‚

#### 3.12.5 OT-CFM ã¨ã®æ¥ç¶šã¨çµ±ä¸€çš„è¦–ç‚¹

OT-CFMï¼ˆÂ§3.9.1å‚ç…§ï¼‰ã¯ Reflow ã®ã€Œç„¡é™å›ç‰ˆã€ã‚’ä¸€ç™ºã§å®Ÿç¾ã—ã‚ˆã†ã¨ã™ã‚‹ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã ã€‚

ç‹¬ç«‹çµåˆ $\mu \otimes \nu$ ã®ä»£ã‚ã‚Šã«ã€æœ€åˆã‹ã‚‰ **$W_2$-æœ€é©è¼¸é€è¨ˆç”»** $\gamma^*$ï¼ˆSinkhorn ã§è¿‘ä¼¼ï¼‰ã«åŸºã¥ã„ã¦ã‚«ãƒƒãƒ—ãƒªãƒ³ã‚° $(\boldsymbol{x}_0, \boldsymbol{x}_1) \sim \gamma^*$ ã‚’ã‚µãƒ³ãƒ—ãƒ«ã—:

$$
\boldsymbol{x}_t = (1-t)\boldsymbol{x}_0 + t\boldsymbol{x}_1, \quad (\boldsymbol{x}_0, \boldsymbol{x}_1) \sim \gamma^*
$$

ã§ Flow Matching ã‚’è¨“ç·´ã™ã‚‹ã€‚ã“ã‚Œã«ã‚ˆã‚Šæœ€åˆã‹ã‚‰ã€Œäº¤å·®ã®ãªã„çµŒè·¯ã€ã§å­¦ç¿’ãŒå§‹ã¾ã‚‹ã€‚

| æ‰‹æ³• | ã‚«ãƒƒãƒ—ãƒªãƒ³ã‚° $\pi$ | äº¤å·®ã®æœ‰ç„¡ | ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã‚¹ãƒ†ãƒƒãƒ— |
|:-----|:-----------------|:----------|:--------------------|
| DDPM (Diffusion) | SDE æ¼¸é€²ãƒã‚¤ã‚ºä»˜åŠ  | N/Aï¼ˆç¢ºç‡çš„ï¼‰ | 1000ã‚¹ãƒ†ãƒƒãƒ— |
| Rectified Flow | $\mu \otimes \nu$ï¼ˆç‹¬ç«‹ï¼‰ | å¤šã„ â†’ Reflow è¦ | å¤šï¼ˆReflow ãªã—ï¼‰ |
| Rectified Flow + Reflow | $\pi_k$ï¼ˆæ”¹å–„æ¸ˆã¿ï¼‰ | å°‘ãªã„ | å°‘ |
| OT-CFM | $\gamma^*$ï¼ˆSinkhornï¼‰ | ã»ã¼ã‚¼ãƒ­ | å°‘ï¼ˆ1ã€œ10ã‚¹ãƒ†ãƒƒãƒ—ï¼‰ |
| Minibatch OT-CFM | $\hat{\gamma}^*$ï¼ˆãƒãƒƒãƒè¿‘ä¼¼ï¼‰ | å°‘ãªã„ | å°‘ |

Tong et al. (2023) [^17] ã®å®Ÿé¨“ã§ã¯ã€OT-CFM ã¯ CIFAR-10 ã§æ¨™æº– Flow Matching ã‚ˆã‚Š FID ã‚’ç´„ 20% æ”¹å–„ã—ã€åŒç­‰å“è³ªã‚’ç´„åŠåˆ†ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã‚¹ãƒ†ãƒƒãƒ—ã§é”æˆã—ãŸã€‚ã€Œæœ€é©è¼¸é€è¨ˆç”»ã§ç‚¹ã‚’ãƒšã‚¢ãƒªãƒ³ã‚°ã™ã‚‹ã€ã¨ã„ã†ä¸€æ‰‹é–“ãŒã€æ¨è«–ã‚³ã‚¹ãƒˆã‚’å¤§å¹…ã«å‰Šæ¸›ã™ã‚‹ã€‚

> **Note:** Wasserstein å‹¾é…æµï¼ˆJKOï¼‰â†’ Fokker-Planck æ–¹ç¨‹å¼ â†’ ç¢ºç‡ãƒ•ãƒ­ãƒ¼ ODE â†’ Rectified Flow â†’ OT-CFM ã¨ã„ã†ä¸€é€£ã®æ¥ç¶šã¯ã€Œç¢ºç‡æ¸¬åº¦ã‚’å‹•ã‹ã™ã€ã¨ã„ã†å…±é€šã®ãƒ†ãƒ¼ãƒã‚’æŒã¤ã€‚ç¬¬36å›ã€ŒFlow Matching çµ±ä¸€ç†è«–ã€ã§ã“ã‚Œã‚‰ã‚’æ•´ç†ã—ã€OT-CFMãƒ»Stochastic Interpolantsãƒ»Consistency Models ã‚’å˜ä¸€ã®æ çµ„ã¿ã§æ¯”è¼ƒã™ã‚‹ã€‚

> Progress: 50%
> **ç†è§£åº¦ãƒã‚§ãƒƒã‚¯**
> 1. Rectified Flow $\dot{X}_t = v_\theta(X_t, t)$ ãŒOT-Mapã¨åŒç­‰ã®ç›´ç·šåŒ–çµŒè·¯ã‚’é”æˆã§ãã‚‹ç†è«–çš„æ ¹æ‹ ã‚’ã€OTè¨ˆç”» $\gamma^*$ ã¨ã®é–¢ä¿‚ã‹ã‚‰èª¬æ˜ã›ã‚ˆã€‚
> 2. Sinkhornåå¾© $u^{(l+1)} = a \oslash (K v^{(l)})$ã€$v^{(l+1)} = b \oslash (K^\top u^{(l+1)})$ï¼ˆ$K_{ij} = \exp(-C_{ij}/\varepsilon)$ï¼‰ãŒãªãœè¼¸é€è¨ˆç”» $\gamma^* = \text{diag}(u) K \text{diag}(v)$ ã«åæŸã™ã‚‹ã‹ã€Sinkhorn-Knoppå®šç†ã®è¦³ç‚¹ã‹ã‚‰ç›´æ„Ÿçš„ã«èª¬æ˜ã›ã‚ˆã€‚

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

### ä¸»è¦è«–æ–‡

[^1]: Monge, G. (1781). MÃ©moire sur la thÃ©orie des dÃ©blais et des remblais. Histoire de l'AcadÃ©mie Royale des Sciences de Paris.

[^2]: Brenier, Y. (1991). Polar factorization and monotone rearrangement of vector-valued functions. Communications on Pure and Applied Mathematics, 44(4), 375-417.

[^3]: Arjovsky, M., Chintala, S., & Bottou, L. (2017). Wasserstein Generative Adversarial Networks. In ICML.
<https://arxiv.org/abs/1701.07875>

[^4]: Liu, X., Gong, C., & Liu, Q. (2022). Flow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flow. In ICLR 2023.
<https://arxiv.org/abs/2209.03003>

[^5]: Song, Y., Sohl-Dickstein, J., Kingma, D. P., Kumar, A., Ermon, S., & Poole, B. (2021). Score-Based Generative Modeling through Stochastic Differential Equations. In ICLR.
<https://arxiv.org/abs/2011.13456>

[^6]: Gulrajani, I., Ahmed, F., Arjovsky, M., Dumoulin, V., & Courville, A. C. (2017). Improved Training of Wasserstein GANs. In NeurIPS.
<https://arxiv.org/abs/1704.00028>

[^7]: Miyato, T., Kataoka, T., Koyama, M., & Yoshida, Y. (2018). Spectral Normalization for Generative Adversarial Networks. In ICLR.
<https://arxiv.org/abs/1802.05957>

[^8]: Amos, B., Xu, L., & Kolter, J. Z. (2017). Input Convex Neural Networks. In ICML.
<https://arxiv.org/abs/1609.07152>

[^9]: Cuturi, M. (2013). Sinkhorn Distances: Lightspeed Computation of Optimal Transport. In NeurIPS.
<https://arxiv.org/abs/1306.0895>

[^10]: Korotin, A., Selikhanovych, D., & Burnaev, E. (2023). Neural Optimal Transport. In ICLR.
<https://arxiv.org/abs/2201.12220>

[^11]: Haviv, D., Kunes, R. Z., Dougherty, T., Burdziak, C., et al. (2024). Wasserstein Wormhole: Scalable Optimal Transport Distance with Transformers. In ICML.
<https://arxiv.org/abs/2404.09411>

[^12]: Korotin, A., Li, L., Genevay, A., Solomon, J., Filippov, A., & Burnaev, E. (2021). Do Neural Optimal Transport Solvers Work? A Continuous Wasserstein-2 Benchmark. In NeurIPS.
<https://arxiv.org/abs/2106.01954>

[^13]: Schmitzer, B. (2016). Stabilized Sparse Scaling Algorithms for Entropy Regularized Transport Problems. SIAM Journal on Scientific Computing, 41(3), A1443-A1481.
<https://arxiv.org/abs/1610.06519>

[^14]: Scetbon, M., Cuturi, M., & PeyrÃ©, G. (2021). Low-Rank Sinkhorn Factorization. In ICML.
<https://arxiv.org/abs/2103.04737>

[^15]: Xie, Y., Wang, X., Wang, R., & Zha, H. (2021). Optimal Transport with f-divergence Regularization and Generalized Sinkhorn Algorithm. In AISTATS.
<https://arxiv.org/abs/2105.14337>

[^16]: Lipman, Y., Chen, R. T. Q., Ben-Hamu, H., Nickel, M., & Le, M. (2023). Flow Matching for Generative Modeling. In ICLR.
<https://arxiv.org/abs/2210.02747>

[^17]: Tong, A., Malkin, N., Huguet, G., Zhang, Y., Rector-Brooks, J., Fatras, K., Wolf, G., & Bengio, Y. (2023). Improving and Generalizing Flow-Based Generative Models with Minibatch Optimal Transport. In AISTATS.
<https://arxiv.org/abs/2302.00482>

[^18]: Pooladian, A. A., Ben-Hamu, H., Domingo-Enrich, C., Amos, B., Lipman, Y., & Chen, R. (2023). Multisample Flow Matching: Straightening Flows with Minibatch Couplings. In ICML.
<https://arxiv.org/abs/2304.14772>

[^19]: Liu, X., Gong, C., & Liu, Q. (2022). Flow Straight and Fast: Learning to Generate and Transfer Data with Rectified Flow. arXiv preprint.
<https://arxiv.org/abs/2209.03003>

[^20]: Zhang, X., Zhao, L., Arnold, A., Liu, N., Rong, Y., & Yan, J. (2020). Optimal Transport Graph Neural Networks. arXiv preprint.
<https://arxiv.org/abs/2006.04804>

[^21]: Hou, X., Zhu, T., Ren, M., Bu, D., Gao, X., Zhang, C., & Sun, S. (2024). Improving Molecular Graph Generation with Flow Matching and Optimal Transport. arXiv preprint.
<https://arxiv.org/abs/2411.05676>

[^22]: Chizat, L., PeyrÃ©, G., Schmitzer, B., & Vialard, F. X. (2018). Scaling Algorithms for Unbalanced Optimal Transport Problems. Mathematics of Computation, 87(314), 2563-2609.
<https://arxiv.org/abs/1607.05816>

### ã‚µãƒ¼ãƒ™ã‚¤è«–æ–‡ãƒ»æ•™ç§‘æ›¸

- PeyrÃ©, G., & Cuturi, M. (2019). Computational Optimal Transport. Foundations and Trends in Machine Learning, 11(5-6), 355-607.
<https://arxiv.org/abs/1803.00567>

- Santambrogio, F. (2015). Optimal Transport for Applied Mathematicians. BirkhÃ¤user.

- Villani, C. (2009). Optimal Transport: Old and New. Springer. (Fields Medalå—è³æ¥­ç¸¾)

### æœ€æ–°ã‚µãƒ¼ãƒ™ã‚¤ (2023)

- Calvello, E., NÃ¼sken, N., Reich, S., & Schillings, C. (2023). Recent Advances in Optimal Transport for Machine Learning. arXiv preprint.
<https://arxiv.org/abs/2306.16156>

---

---

## è‘—è€…ãƒªãƒ³ã‚¯

- Blog: https://fumishiki.dev
- X: https://x.com/fumishiki
- LinkedIn: https://www.linkedin.com/in/fumitakamurakami
- GitHub: https://github.com/fumishiki
- Hugging Face: https://huggingface.co/fumishiki

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

æœ¬è¨˜äº‹ã¯ [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.ja)ï¼ˆã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãƒ»ã‚³ãƒ¢ãƒ³ã‚º è¡¨ç¤º - éå–¶åˆ© - ç¶™æ‰¿ 4.0 å›½éš›ï¼‰ã®ä¸‹ã§ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã•ã‚Œã¦ã„ã¾ã™ã€‚

### âš ï¸ åˆ©ç”¨åˆ¶é™ã«ã¤ã„ã¦

**æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯å€‹äººã®å­¦ç¿’ç›®çš„ã«é™ã‚Šåˆ©ç”¨å¯èƒ½ã§ã™ã€‚**

**ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã¯äº‹å‰ã®æ˜ç¤ºçš„ãªè¨±å¯ãªãåˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’å›ºãç¦ã˜ã¾ã™:**

1. **ä¼æ¥­ãƒ»çµ„ç¹”å†…ã§ã®åˆ©ç”¨ï¼ˆå–¶åˆ©ãƒ»éå–¶åˆ©å•ã‚ãšï¼‰**
   - ç¤¾å†…ç ”ä¿®ã€æ•™è‚²ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã€ç¤¾å†…Wikiã¸ã®è»¢è¼‰
   - å¤§å­¦ãƒ»ç ”ç©¶æ©Ÿé–¢ã§ã®è¬›ç¾©åˆ©ç”¨
   - éå–¶åˆ©å›£ä½“ã§ã®ç ”ä¿®åˆ©ç”¨
   - **ç†ç”±**: çµ„ç¹”å†…åˆ©ç”¨ã§ã¯å¸°å±è¡¨ç¤ºãŒå‰Šé™¤ã•ã‚Œã‚„ã™ãã€ç„¡æ–­æ”¹å¤‰ã®ãƒªã‚¹ã‚¯ãŒé«˜ã„ãŸã‚

2. **æœ‰æ–™ã‚¹ã‚¯ãƒ¼ãƒ«ãƒ»æƒ…å ±å•†æãƒ»ã‚»ãƒŸãƒŠãƒ¼ã§ã®åˆ©ç”¨**
   - å—è¬›æ–™ã‚’å¾´åã™ã‚‹å ´ã§ã®é…å¸ƒã€ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®æ²ç¤ºã€æ´¾ç”Ÿæ•™æã®ä½œæˆ

3. **LLM/AIãƒ¢ãƒ‡ãƒ«ã®å­¦ç¿’ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ã®åˆ©ç”¨**
   - å•†ç”¨ãƒ¢ãƒ‡ãƒ«ã®Pre-trainingã€Fine-tuningã€RAGã®çŸ¥è­˜ã‚½ãƒ¼ã‚¹ã¨ã—ã¦æœ¬ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ãƒ»åˆ©ç”¨ã™ã‚‹ã“ã¨

4. **å‹æ‰‹ã«å†…å®¹ã‚’æœ‰æ–™åŒ–ã™ã‚‹è¡Œç‚ºå…¨èˆ¬**
   - æœ‰æ–™noteã€æœ‰æ–™è¨˜äº‹ã€Kindleå‡ºç‰ˆã€æœ‰æ–™å‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€Patreoné™å®šã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç­‰

**å€‹äººåˆ©ç”¨ã«å«ã¾ã‚Œã‚‹ã‚‚ã®:**
- å€‹äººã®å­¦ç¿’ãƒ»ç ”ç©¶
- å€‹äººçš„ãªãƒãƒ¼ãƒˆä½œæˆï¼ˆå€‹äººåˆ©ç”¨ã«é™ã‚‹ï¼‰
- å‹äººã¸ã®å…ƒè¨˜äº‹ãƒªãƒ³ã‚¯å…±æœ‰

**çµ„ç¹”ã§ã®å°å…¥ã‚’ã”å¸Œæœ›ã®å ´åˆ**ã¯ã€å¿…ãšè‘—è€…ã«é€£çµ¡ã‚’å–ã‚Šã€ä»¥ä¸‹ã‚’éµå®ˆã—ã¦ãã ã•ã„:
- å…¨ã¦ã®å¸°å±è¡¨ç¤ºãƒªãƒ³ã‚¯ã‚’ç¶­æŒ
- åˆ©ç”¨æ–¹æ³•ã‚’è‘—è€…ã«å ±å‘Š

**ç„¡æ–­åˆ©ç”¨ãŒç™ºè¦šã—ãŸå ´åˆ**ã€ä½¿ç”¨æ–™ã®è«‹æ±‚ãŠã‚ˆã³SNSç­‰ã§ã®å…¬è¡¨ã‚’è¡Œã†å ´åˆãŒã‚ã‚Šã¾ã™ã€‚
